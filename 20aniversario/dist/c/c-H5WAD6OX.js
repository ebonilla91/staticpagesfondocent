import{a as hr,b as Br}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-6I66JAMQ.js";import{b as Me,c as Sr}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-OAY73AJW.js";import{a as ur,b as Ze,d as _r}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-IDSWT3EJ.js";var mr,Oe,De,Ce,pe,Hr,Te,We,Dr,Or,Rr,Yr,gr,dr,Xr,$r,qr,Vr,br,wr=ur(()=>{"use strict";mr=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Oe=n=>{let t=0;for(let l=0;l<n.length;l++){let u=n[l],g=mr.indexOf(u);t=t*83+g}return t},De=(n,t)=>{var l="";for(let u=1;u<=t;u++){let g=Math.floor(n)/Math.pow(83,t-u)%83;l+=mr[Math.floor(g)]}return l},Ce=n=>{let t=n/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},pe=n=>{let t=Math.max(0,Math.min(1,n));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},Hr=n=>n<0?-1:1,Te=(n,t)=>Hr(n)*Math.pow(Math.abs(n),t),We=class extends Error{constructor(n){super(n),this.name="ValidationError",this.message=n}},Dr=n=>{if(!n||n.length<6)throw new We("The blurhash string must be at least 6 characters");let t=Oe(n[0]),l=Math.floor(t/9)+1,u=t%9+1;if(n.length!==4+2*u*l)throw new We(`blurhash length mismatch: length is ${n.length} but it should be ${4+2*u*l}`)},Or=n=>{let t=n>>16,l=n>>8&255,u=n&255;return[Ce(t),Ce(l),Ce(u)]},Rr=(n,t)=>{let l=Math.floor(n/361),u=Math.floor(n/19)%19,g=n%19;return[Te((l-9)/9,2)*t,Te((u-9)/9,2)*t,Te((g-9)/9,2)*t]},Yr=(n,t,l,u)=>{Dr(n),u=u|1;let g=Oe(n[0]),A=Math.floor(g/9)+1,T=g%9+1,Q=(Oe(n[1])+1)/166,I=new Array(T*A);for(let O=0;O<I.length;O++)if(O===0){let X=Oe(n.substring(2,6));I[O]=Or(X)}else{let X=Oe(n.substring(4+O*2,6+O*2));I[O]=Rr(X,Q*u)}let K=t*4,fe=new Uint8ClampedArray(K*l);for(let O=0;O<l;O++)for(let X=0;X<t;X++){let ce=0,he=0,de=0;for(let x=0;x<A;x++)for(let c=0;c<T;c++){let a=Math.cos(Math.PI*X*c/t)*Math.cos(Math.PI*O*x/l),E=I[c+x*T];ce+=E[0]*a,he+=E[1]*a,de+=E[2]*a}let be=pe(ce),me=pe(he),B=pe(de);fe[4*X+0+O*K]=be,fe[4*X+1+O*K]=me,fe[4*X+2+O*K]=B,fe[4*X+3+O*K]=255}return fe},gr=Yr,dr=4,Xr=(n,t,l,u)=>{let g=0,A=0,T=0,Q=t*dr;for(let K=0;K<t;K++){let fe=dr*K;for(let O=0;O<l;O++){let X=fe+O*Q,ce=u(K,O);g+=ce*Ce(n[X]),A+=ce*Ce(n[X+1]),T+=ce*Ce(n[X+2])}}let I=1/(t*l);return[g*I,A*I,T*I]},$r=n=>{let t=pe(n[0]),l=pe(n[1]),u=pe(n[2]);return(t<<16)+(l<<8)+u},qr=(n,t)=>{let l=Math.floor(Math.max(0,Math.min(18,Math.floor(Te(n[0]/t,.5)*9+9.5)))),u=Math.floor(Math.max(0,Math.min(18,Math.floor(Te(n[1]/t,.5)*9+9.5)))),g=Math.floor(Math.max(0,Math.min(18,Math.floor(Te(n[2]/t,.5)*9+9.5))));return l*19*19+u*19+g},Vr=(n,t,l,u,g)=>{if(u<1||u>9||g<1||g>9)throw new We("BlurHash must have between 1 and 9 components");if(t*l*4!==n.length)throw new We("Width and height must match the pixels array");let A=[];for(let O=0;O<g;O++)for(let X=0;X<u;X++){let ce=X==0&&O==0?1:2,he=Xr(n,t,l,(de,be)=>ce*Math.cos(Math.PI*X*de/t)*Math.cos(Math.PI*O*be/l));A.push(he)}let T=A[0],Q=A.slice(1),I="",K=u-1+(g-1)*9;I+=De(K,1);let fe;if(Q.length>0){let O=Math.max(...Q.map(ce=>Math.max(...ce))),X=Math.floor(Math.max(0,Math.min(82,Math.floor(O*166-.5))));fe=(X+1)/166,I+=De(X,1)}else fe=1,I+=De(0,1);return I+=De($r(T),4),Q.forEach(O=>{I+=De(qr(O,fe),2)}),I},br=Vr});var Mr=Ze((o0,Ge)=>{"use strict";var yr=yr||function(n){return Buffer.from(n).toString("base64")};function Wr(n){var t=this,l=Math.round,u=Math.floor,g=new Array(64),A=new Array(64),T=new Array(64),Q=new Array(64),I,K,fe,O,X=new Array(65535),ce=new Array(65535),he=new Array(64),de=new Array(64),be=[],me=0,B=7,x=new Array(64),c=new Array(64),a=new Array(64),E=new Array(256),i=new Array(2048),_,b=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],w=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ve=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],se=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ae(e){for(var h=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],y=0;y<64;y++){var m=u((h[y]*e+50)/100);m<1?m=1:m>255&&(m=255),g[b[y]]=m}for(var p=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],L=0;L<64;L++){var j=u((p[L]*e+50)/100);j<1?j=1:j>255&&(j=255),A[b[L]]=j}for(var J=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],le=0,oe=0;oe<8;oe++)for(var o=0;o<8;o++)T[le]=1/(g[b[le]]*J[oe]*J[o]*8),Q[le]=1/(A[b[le]]*J[oe]*J[o]*8),le++}function $(e,h){for(var y=0,m=0,p=new Array,L=1;L<=16;L++){for(var j=1;j<=e[L];j++)p[h[m]]=[],p[h[m]][0]=y,p[h[m]][1]=L,m++,y++;y*=2}return p}function ue(){I=$(C,R),K=$(ve,F),fe=$(z,w),O=$(Y,se)}function Z(){for(var e=1,h=2,y=1;y<=15;y++){for(var m=e;m<h;m++)ce[32767+m]=y,X[32767+m]=[],X[32767+m][1]=y,X[32767+m][0]=m;for(var p=-(h-1);p<=-e;p++)ce[32767+p]=y,X[32767+p]=[],X[32767+p][1]=y,X[32767+p][0]=h-1+p;e<<=1,h<<=1}}function V(){for(var e=0;e<256;e++)i[e]=19595*e,i[e+256>>0]=38470*e,i[e+512>>0]=7471*e+32768,i[e+768>>0]=-11059*e,i[e+1024>>0]=-21709*e,i[e+1280>>0]=32768*e+8421375,i[e+1536>>0]=-27439*e,i[e+1792>>0]=-5329*e}function S(e){for(var h=e[0],y=e[1]-1;y>=0;)h&1<<y&&(me|=1<<B),y--,B--,B<0&&(me==255?(r(255),r(0)):r(me),B=7,me=0)}function r(e){be.push(e)}function d(e){r(e>>8&255),r(e&255)}function ee(e,h){var y,m,p,L,j,J,le,oe,o=0,v,P=8,xe=64;for(v=0;v<P;++v){y=e[o],m=e[o+1],p=e[o+2],L=e[o+3],j=e[o+4],J=e[o+5],le=e[o+6],oe=e[o+7];var k=y+oe,q=y-oe,ne=m+le,M=m-le,N=p+J,ge=p-J,ie=L+j,Fe=L-j,Ue=k+ie,Pe=k-ie,Ae=ne+N,Ee=ne-N;e[o]=Ue+Ae,e[o+4]=Ue-Ae;var Le=(Ee+Pe)*.707106781;e[o+2]=Pe+Le,e[o+6]=Pe-Le,Ue=Fe+ge,Ae=ge+M,Ee=M+q;var ke=(Ue-Ee)*.382683433,Xe=.5411961*Ue+ke,Ie=1.306562965*Ee+ke,_e=Ae*.707106781,Se=q+_e,Be=q-_e;e[o+5]=Be+Xe,e[o+3]=Be-Xe,e[o+1]=Se+Ie,e[o+7]=Se-Ie,o+=8}for(o=0,v=0;v<P;++v){y=e[o],m=e[o+8],p=e[o+16],L=e[o+24],j=e[o+32],J=e[o+40],le=e[o+48],oe=e[o+56];var er=y+oe,je=y-oe,rr=m+le,nr=m-le,ar=p+J,tr=p-J,or=L+j,Ir=L-j,He=er+or,Je=er-or,$e=rr+ar,qe=rr-ar;e[o]=He+$e,e[o+32]=He-$e;var ir=(qe+Je)*.707106781;e[o+16]=Je+ir,e[o+48]=Je-ir,He=Ir+tr,$e=tr+nr,qe=nr+je;var sr=(He-qe)*.382683433,xr=.5411961*He+sr,fr=1.306562965*qe+sr,lr=$e*.707106781,cr=je+lr,vr=je-lr;e[o+40]=vr+xr,e[o+24]=vr-xr,e[o+8]=cr+fr,e[o+56]=cr-fr,o++}var Ve;for(v=0;v<xe;++v)Ve=e[v]*h[v],he[v]=Ve>0?Ve+.5|0:Ve-.5|0;return he}function re(){d(65504),d(16),r(74),r(70),r(73),r(70),r(0),r(1),r(1),r(0),d(1),d(1),r(0),r(0)}function W(e){if(e){d(65505),e[0]===69&&e[1]===120&&e[2]===105&&e[3]===102?d(e.length+2):(d(e.length+5+2),r(69),r(120),r(105),r(102),r(0));for(var h=0;h<e.length;h++)r(e[h])}}function G(e,h){d(65472),d(17),r(8),d(h),d(e),r(3),r(1),r(17),r(0),r(2),r(17),r(1),r(3),r(17),r(1)}function H(){d(65499),d(132),r(0);for(var e=0;e<64;e++)r(g[e]);r(1);for(var h=0;h<64;h++)r(A[h])}function f(){d(65476),d(418),r(0);for(var e=0;e<16;e++)r(C[e+1]);for(var h=0;h<=11;h++)r(R[h]);r(16);for(var y=0;y<16;y++)r(z[y+1]);for(var m=0;m<=161;m++)r(w[m]);r(1);for(var p=0;p<16;p++)r(ve[p+1]);for(var L=0;L<=11;L++)r(F[L]);r(17);for(var j=0;j<16;j++)r(Y[j+1]);for(var J=0;J<=161;J++)r(se[J])}function s(e){typeof e>"u"||e.constructor!==Array||e.forEach(h=>{if(typeof h=="string"){d(65534);var y=h.length;d(y+2);var m;for(m=0;m<y;m++)r(h.charCodeAt(m))}})}function te(){d(65498),d(12),r(3),r(1),r(0),r(2),r(17),r(3),r(17),r(0),r(63),r(0)}function U(e,h,y,m,p){for(var L=p[0],j=p[240],J,le=16,oe=63,o=64,v=ee(e,h),P=0;P<o;++P)de[b[P]]=v[P];var xe=de[0]-y;y=de[0],xe==0?S(m[0]):(J=32767+xe,S(m[ce[J]]),S(X[J]));for(var k=63;k>0&&de[k]==0;k--);if(k==0)return S(L),y;for(var q=1,ne;q<=k;){for(var M=q;de[q]==0&&q<=k;++q);var N=q-M;if(N>=le){ne=N>>4;for(var ge=1;ge<=ne;++ge)S(j);N=N&15}J=32767+de[q],S(p[(N<<4)+ce[J]]),S(X[J]),q++}return k!=oe&&S(L),y}function D(){for(var e=String.fromCharCode,h=0;h<256;h++)E[h]=e(h)}this.encode=function(e,h){var y=new Date().getTime();h&&we(h),be=new Array,me=0,B=7,d(65496),re(),s(e.comments),W(e.exifBuffer),H(),G(e.width,e.height),f(),te();var m=0,p=0,L=0;me=0,B=7,this.encode.displayName="_encode_";for(var j=e.data,J=e.width,le=e.height,oe=J*4,o=J*3,v,P=0,xe,k,q,ne,M,N,ge,ie;P<le;){for(v=0;v<oe;){for(ne=oe*P+v,M=ne,N=-1,ge=0,ie=0;ie<64;ie++)ge=ie>>3,N=(ie&7)*4,M=ne+ge*oe+N,P+ge>=le&&(M-=oe*(P+1+ge-le)),v+N>=oe&&(M-=v+N-oe+4),xe=j[M++],k=j[M++],q=j[M++],x[ie]=(i[xe]+i[k+256>>0]+i[q+512>>0]>>16)-128,c[ie]=(i[xe+768>>0]+i[k+1024>>0]+i[q+1280>>0]>>16)-128,a[ie]=(i[xe+1280>>0]+i[k+1536>>0]+i[q+1792>>0]>>16)-128;m=U(x,T,m,I,fe),p=U(c,Q,p,K,O),L=U(a,Q,L,K,O),v+=32}P+=8}if(B>=0){var Fe=[];Fe[1]=B+1,Fe[0]=(1<<B+1)-1,S(Fe)}if(d(65497),typeof Ge>"u")return new Uint8Array(be);return Buffer.from(be);var Ue,Pe};function we(e){if(e<=0&&(e=1),e>100&&(e=100),_!=e){var h=0;e<50?h=Math.floor(5e3/e):h=Math.floor(200-e*2),ae(h),_=e}}function ye(){var e=new Date().getTime();n||(n=50),D(),ue(),Z(),V(),we(n);var h=new Date().getTime()-e}ye()}typeof Ge<"u"?Ge.exports=Fr:typeof window<"u"&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].encode=Fr);function Fr(n,t){typeof t>"u"&&(t=50);var l=new Wr(t),u=l.encode(n,t);return{data:u,width:n.width,height:n.height}}});var Pr=Ze((i0,Ke)=>{"use strict";var Ne=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),l=4017,u=799,g=3406,A=2276,T=1567,Q=3784,I=5793,K=2896;function fe(){}function O(B,x){for(var c=0,a=[],E,i,_=16;_>0&&!B[_-1];)_--;a.push({children:[],index:0});var b=a[0],C;for(E=0;E<_;E++){for(i=0;i<B[E];i++){for(b=a.pop(),b.children[b.index]=x[c];b.index>0;){if(a.length===0)throw new Error("Could not recreate Huffman Table");b=a.pop()}for(b.index++,a.push(b);a.length<=E;)a.push(C={children:[],index:0}),b.children[b.index]=C.children,b=C;c++}E+1<_&&(a.push(C={children:[],index:0}),b.children[b.index]=C.children,b=C)}return a[0].children}function X(B,x,c,a,E,i,_,b,C,R){var z=c.precision,w=c.samplesPerLine,ve=c.scanLines,F=c.mcusPerLine,Y=c.progressive,se=c.maxH,ae=c.maxV,$=x,ue=0,Z=0;function V(){if(Z>0)return Z--,ue>>Z&1;if(ue=B[x++],ue==255){var o=B[x++];if(o)throw new Error("unexpected marker: "+(ue<<8|o).toString(16))}return Z=7,ue>>>7}function S(o){for(var v=o,P;(P=V())!==null;){if(v=v[P],typeof v=="number")return v;if(typeof v!="object")throw new Error("invalid huffman sequence")}return null}function r(o){for(var v=0;o>0;){var P=V();if(P===null)return;v=v<<1|P,o--}return v}function d(o){var v=r(o);return v>=1<<o-1?v:v+(-1<<o)+1}function ee(o,v){var P=S(o.huffmanTableDC),xe=P===0?0:d(P);v[0]=o.pred+=xe;for(var k=1;k<64;){var q=S(o.huffmanTableAC),ne=q&15,M=q>>4;if(ne===0){if(M<15)break;k+=16;continue}k+=M;var N=t[k];v[N]=d(ne),k++}}function re(o,v){var P=S(o.huffmanTableDC),xe=P===0?0:d(P)<<C;v[0]=o.pred+=xe}function W(o,v){v[0]|=V()<<C}var G=0;function H(o,v){if(G>0){G--;return}for(var P=i,xe=_;P<=xe;){var k=S(o.huffmanTableAC),q=k&15,ne=k>>4;if(q===0){if(ne<15){G=r(ne)+(1<<ne)-1;break}P+=16;continue}P+=ne;var M=t[P];v[M]=d(q)*(1<<C),P++}}var f=0,s;function te(o,v){for(var P=i,xe=_,k=0;P<=xe;){var q=t[P],ne=v[q]<0?-1:1;switch(f){case 0:var M=S(o.huffmanTableAC),N=M&15,k=M>>4;if(N===0)k<15?(G=r(k)+(1<<k),f=4):(k=16,f=1);else{if(N!==1)throw new Error("invalid ACn encoding");s=d(N),f=k?2:3}continue;case 1:case 2:v[q]?v[q]+=(V()<<C)*ne:(k--,k===0&&(f=f==2?3:0));break;case 3:v[q]?v[q]+=(V()<<C)*ne:(v[q]=s<<C,f=0);break;case 4:v[q]&&(v[q]+=(V()<<C)*ne);break}P++}f===4&&(G--,G===0&&(f=0))}function U(o,v,P,xe,k){var q=P/F|0,ne=P%F,M=q*o.v+xe,N=ne*o.h+k;o.blocks[M]===void 0&&R.tolerantDecoding||v(o,o.blocks[M][N])}function D(o,v,P){var xe=P/o.blocksPerLine|0,k=P%o.blocksPerLine;o.blocks[xe]===void 0&&R.tolerantDecoding||v(o,o.blocks[xe][k])}var we=a.length,ye,e,h,y,m,p;Y?i===0?p=b===0?re:W:p=b===0?H:te:p=ee;var L=0,j,J;we==1?J=a[0].blocksPerLine*a[0].blocksPerColumn:J=F*c.mcusPerColumn,E||(E=J);for(var le,oe;L<J;){for(e=0;e<we;e++)a[e].pred=0;if(G=0,we==1)for(ye=a[0],m=0;m<E;m++)D(ye,p,L),L++;else for(m=0;m<E;m++){for(e=0;e<we;e++)for(ye=a[e],le=ye.h,oe=ye.v,h=0;h<oe;h++)for(y=0;y<le;y++)U(ye,p,L,h,y);if(L++,L===J)break}if(L===J)do{if(B[x]===255&&B[x+1]!==0)break;x+=1}while(x<B.length-2);if(Z=0,j=B[x]<<8|B[x+1],j<65280)throw new Error("marker was not found");if(j>=65488&&j<=65495)x+=2;else break}return x-$}function ce(B,x){var c=[],a=x.blocksPerLine,E=x.blocksPerColumn,i=a<<3,_=new Int32Array(64),b=new Uint8Array(64);function C($,ue,Z){var V=x.quantizationTable,S,r,d,ee,re,W,G,H,f,s=Z,te;for(te=0;te<64;te++)s[te]=$[te]*V[te];for(te=0;te<8;++te){var U=8*te;if(s[1+U]==0&&s[2+U]==0&&s[3+U]==0&&s[4+U]==0&&s[5+U]==0&&s[6+U]==0&&s[7+U]==0){f=I*s[0+U]+512>>10,s[0+U]=f,s[1+U]=f,s[2+U]=f,s[3+U]=f,s[4+U]=f,s[5+U]=f,s[6+U]=f,s[7+U]=f;continue}S=I*s[0+U]+128>>8,r=I*s[4+U]+128>>8,d=s[2+U],ee=s[6+U],re=K*(s[1+U]-s[7+U])+128>>8,H=K*(s[1+U]+s[7+U])+128>>8,W=s[3+U]<<4,G=s[5+U]<<4,f=S-r+1>>1,S=S+r+1>>1,r=f,f=d*Q+ee*T+128>>8,d=d*T-ee*Q+128>>8,ee=f,f=re-G+1>>1,re=re+G+1>>1,G=f,f=H+W+1>>1,W=H-W+1>>1,H=f,f=S-ee+1>>1,S=S+ee+1>>1,ee=f,f=r-d+1>>1,r=r+d+1>>1,d=f,f=re*A+H*g+2048>>12,re=re*g-H*A+2048>>12,H=f,f=W*u+G*l+2048>>12,W=W*l-G*u+2048>>12,G=f,s[0+U]=S+H,s[7+U]=S-H,s[1+U]=r+G,s[6+U]=r-G,s[2+U]=d+W,s[5+U]=d-W,s[3+U]=ee+re,s[4+U]=ee-re}for(te=0;te<8;++te){var D=te;if(s[8+D]==0&&s[16+D]==0&&s[24+D]==0&&s[32+D]==0&&s[40+D]==0&&s[48+D]==0&&s[56+D]==0){f=I*Z[te+0]+8192>>14,s[0+D]=f,s[8+D]=f,s[16+D]=f,s[24+D]=f,s[32+D]=f,s[40+D]=f,s[48+D]=f,s[56+D]=f;continue}S=I*s[0+D]+2048>>12,r=I*s[32+D]+2048>>12,d=s[16+D],ee=s[48+D],re=K*(s[8+D]-s[56+D])+2048>>12,H=K*(s[8+D]+s[56+D])+2048>>12,W=s[24+D],G=s[40+D],f=S-r+1>>1,S=S+r+1>>1,r=f,f=d*Q+ee*T+2048>>12,d=d*T-ee*Q+2048>>12,ee=f,f=re-G+1>>1,re=re+G+1>>1,G=f,f=H+W+1>>1,W=H-W+1>>1,H=f,f=S-ee+1>>1,S=S+ee+1>>1,ee=f,f=r-d+1>>1,r=r+d+1>>1,d=f,f=re*A+H*g+2048>>12,re=re*g-H*A+2048>>12,H=f,f=W*u+G*l+2048>>12,W=W*l-G*u+2048>>12,G=f,s[0+D]=S+H,s[56+D]=S-H,s[8+D]=r+G,s[48+D]=r-G,s[16+D]=d+W,s[40+D]=d-W,s[24+D]=ee+re,s[32+D]=ee-re}for(te=0;te<64;++te){var we=128+(s[te]+8>>4);ue[te]=we<0?0:we>255?255:we}}me(i*E*8);for(var R,z,w=0;w<E;w++){var ve=w<<3;for(R=0;R<8;R++)c.push(new Uint8Array(i));for(var F=0;F<a;F++){C(x.blocks[w][F],b,_);var Y=0,se=F<<3;for(z=0;z<8;z++){var ae=c[ve+z];for(R=0;R<8;R++)ae[se+R]=b[Y++]}}}return c}function he(B){return B<0?0:B>255?255:B}fe.prototype={load:function(x){var c=new XMLHttpRequest;c.open("GET",x,!0),c.responseType="arraybuffer",c.onload=function(){var a=new Uint8Array(c.response||c.mozResponseArrayBuffer);this.parse(a),this.onload&&this.onload()}.bind(this),c.send(null)},parse:function(x){var c=this.opts.maxResolutionInMP*1e3*1e3,a=0,E=x.length;function i(){var M=x[a]<<8|x[a+1];return a+=2,M}function _(){var M=i(),N=x.subarray(a,a+M-2);return a+=N.length,N}function b(M){var N=1,ge=1,ie,Fe;for(Fe in M.components)M.components.hasOwnProperty(Fe)&&(ie=M.components[Fe],N<ie.h&&(N=ie.h),ge<ie.v&&(ge=ie.v));var Ue=Math.ceil(M.samplesPerLine/8/N),Pe=Math.ceil(M.scanLines/8/ge);for(Fe in M.components)if(M.components.hasOwnProperty(Fe)){ie=M.components[Fe];var Ae=Math.ceil(Math.ceil(M.samplesPerLine/8)*ie.h/N),Ee=Math.ceil(Math.ceil(M.scanLines/8)*ie.v/ge),Le=Ue*ie.h,ke=Pe*ie.v,Xe=ke*Le,Ie=[];me(Xe*256);for(var _e=0;_e<ke;_e++){for(var Se=[],Be=0;Be<Le;Be++)Se.push(new Int32Array(64));Ie.push(Se)}ie.blocksPerLine=Ae,ie.blocksPerColumn=Ee,ie.blocks=Ie}M.maxH=N,M.maxV=ge,M.mcusPerLine=Ue,M.mcusPerColumn=Pe}var C=null,R=null,z=null,w,ve,F=[],Y=[],se=[],ae=[],$=i(),ue=-1;if(this.comments=[],$!=65496)throw new Error("SOI not found");for($=i();$!=65497;){var Z,V,S;switch($){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var r=_();if($===65534){var d=String.fromCharCode.apply(null,r);this.comments.push(d)}$===65504&&r[0]===74&&r[1]===70&&r[2]===73&&r[3]===70&&r[4]===0&&(C={version:{major:r[5],minor:r[6]},densityUnits:r[7],xDensity:r[8]<<8|r[9],yDensity:r[10]<<8|r[11],thumbWidth:r[12],thumbHeight:r[13],thumbData:r.subarray(14,14+3*r[12]*r[13])}),$===65505&&r[0]===69&&r[1]===120&&r[2]===105&&r[3]===102&&r[4]===0&&(this.exifBuffer=r.subarray(5,r.length)),$===65518&&r[0]===65&&r[1]===100&&r[2]===111&&r[3]===98&&r[4]===101&&r[5]===0&&(R={version:r[6],flags0:r[7]<<8|r[8],flags1:r[9]<<8|r[10],transformCode:r[11]});break;case 65499:for(var ee=i(),re=ee+a-2;a<re;){var W=x[a++];me(256);var G=new Int32Array(64);if(W>>4)if(W>>4===1)for(V=0;V<64;V++){var H=t[V];G[H]=i()}else throw new Error("DQT: invalid table spec");else for(V=0;V<64;V++){var H=t[V];G[H]=x[a++]}F[W&15]=G}break;case 65472:case 65473:case 65474:i(),w={},w.extended=$===65473,w.progressive=$===65474,w.precision=x[a++],w.scanLines=i(),w.samplesPerLine=i(),w.components={},w.componentsOrder=[];var f=w.scanLines*w.samplesPerLine;if(f>c){var s=Math.ceil((f-c)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${s}MP`)}var te=x[a++],U,D=0,we=0;for(Z=0;Z<te;Z++){U=x[a];var ye=x[a+1]>>4,e=x[a+1]&15,h=x[a+2];if(ye<=0||e<=0)throw new Error("Invalid sampling factor, expected values above 0");w.componentsOrder.push(U),w.components[U]={h:ye,v:e,quantizationIdx:h},a+=3}b(w),Y.push(w);break;case 65476:var y=i();for(Z=2;Z<y;){var m=x[a++],p=new Uint8Array(16),L=0;for(V=0;V<16;V++,a++)L+=p[V]=x[a];me(16+L);var j=new Uint8Array(L);for(V=0;V<L;V++,a++)j[V]=x[a];Z+=17+L,(m>>4?se:ae)[m&15]=O(p,j)}break;case 65501:i(),ve=i();break;case 65500:i(),i();break;case 65498:var J=i(),le=x[a++],oe=[],o;for(Z=0;Z<le;Z++){o=w.components[x[a++]];var v=x[a++];o.huffmanTableDC=ae[v>>4],o.huffmanTableAC=se[v&15],oe.push(o)}var P=x[a++],xe=x[a++],k=x[a++],q=X(x,a,w,oe,ve,P,xe,k>>4,k&15,this.opts);a+=q;break;case 65535:x[a]!==255&&a--;break;default:if(x[a-3]==255&&x[a-2]>=192&&x[a-2]<=254){a-=3;break}else if($===224||$==225){if(ue!==-1)throw new Error(`first unknown JPEG marker at offset ${ue.toString(16)}, second unknown JPEG marker ${$.toString(16)} at offset ${(a-1).toString(16)}`);ue=a-1;let M=i();if(x[a+M-2]===255){a+=M-2;break}}throw new Error("unknown JPEG marker "+$.toString(16))}$=i()}if(Y.length!=1)throw new Error("only single frame JPEGs supported");for(var Z=0;Z<Y.length;Z++){var ne=Y[Z].components;for(var V in ne)ne[V].quantizationTable=F[ne[V].quantizationIdx],delete ne[V].quantizationIdx}this.width=w.samplesPerLine,this.height=w.scanLines,this.jfif=C,this.adobe=R,this.components=[];for(var Z=0;Z<w.componentsOrder.length;Z++){var o=w.components[w.componentsOrder[Z]];this.components.push({lines:ce(w,o),scaleX:o.h/w.maxH,scaleY:o.v/w.maxV})}},getData:function(x,c){var a=this.width/x,E=this.height/c,i,_,b,C,R,z,w,ve,F,Y,se=0,ae,$,ue,Z,V,S,r,d,ee,re,W,G=x*c*this.components.length;me(G);var H=new Uint8Array(G);switch(this.components.length){case 1:for(i=this.components[0],Y=0;Y<c;Y++)for(R=i.lines[0|Y*i.scaleY*E],F=0;F<x;F++)ae=R[0|F*i.scaleX*a],H[se++]=ae;break;case 2:for(i=this.components[0],_=this.components[1],Y=0;Y<c;Y++)for(R=i.lines[0|Y*i.scaleY*E],z=_.lines[0|Y*_.scaleY*E],F=0;F<x;F++)ae=R[0|F*i.scaleX*a],H[se++]=ae,ae=z[0|F*_.scaleX*a],H[se++]=ae;break;case 3:for(W=!0,this.adobe&&this.adobe.transformCode?W=!0:typeof this.opts.colorTransform<"u"&&(W=!!this.opts.colorTransform),i=this.components[0],_=this.components[1],b=this.components[2],Y=0;Y<c;Y++)for(R=i.lines[0|Y*i.scaleY*E],z=_.lines[0|Y*_.scaleY*E],w=b.lines[0|Y*b.scaleY*E],F=0;F<x;F++)W?(ae=R[0|F*i.scaleX*a],$=z[0|F*_.scaleX*a],ue=w[0|F*b.scaleX*a],d=he(ae+1.402*(ue-128)),ee=he(ae-.3441363*($-128)-.71413636*(ue-128)),re=he(ae+1.772*($-128))):(d=R[0|F*i.scaleX*a],ee=z[0|F*_.scaleX*a],re=w[0|F*b.scaleX*a]),H[se++]=d,H[se++]=ee,H[se++]=re;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(W=!1,this.adobe&&this.adobe.transformCode?W=!0:typeof this.opts.colorTransform<"u"&&(W=!!this.opts.colorTransform),i=this.components[0],_=this.components[1],b=this.components[2],C=this.components[3],Y=0;Y<c;Y++)for(R=i.lines[0|Y*i.scaleY*E],z=_.lines[0|Y*_.scaleY*E],w=b.lines[0|Y*b.scaleY*E],ve=C.lines[0|Y*C.scaleY*E],F=0;F<x;F++)W?(ae=R[0|F*i.scaleX*a],$=z[0|F*_.scaleX*a],ue=w[0|F*b.scaleX*a],Z=ve[0|F*C.scaleX*a],V=255-he(ae+1.402*(ue-128)),S=255-he(ae-.3441363*($-128)-.71413636*(ue-128)),r=255-he(ae+1.772*($-128))):(V=R[0|F*i.scaleX*a],S=z[0|F*_.scaleX*a],r=w[0|F*b.scaleX*a],Z=ve[0|F*C.scaleX*a]),H[se++]=255-V,H[se++]=255-S,H[se++]=255-r,H[se++]=255-Z;break;default:throw new Error("Unsupported color mode")}return H},copyToImageData:function(x,c){var a=x.width,E=x.height,i=x.data,_=this.getData(a,E),b=0,C=0,R,z,w,ve,F,Y,se,ae,$;switch(this.components.length){case 1:for(z=0;z<E;z++)for(R=0;R<a;R++)w=_[b++],i[C++]=w,i[C++]=w,i[C++]=w,c&&(i[C++]=255);break;case 3:for(z=0;z<E;z++)for(R=0;R<a;R++)se=_[b++],ae=_[b++],$=_[b++],i[C++]=se,i[C++]=ae,i[C++]=$,c&&(i[C++]=255);break;case 4:for(z=0;z<E;z++)for(R=0;R<a;R++)F=_[b++],Y=_[b++],w=_[b++],ve=_[b++],se=255-he(F*(1-ve/255)+ve),ae=255-he(Y*(1-ve/255)+ve),$=255-he(w*(1-ve/255)+ve),i[C++]=se,i[C++]=ae,i[C++]=$,c&&(i[C++]=255);break;default:throw new Error("Unsupported color mode")}}};var de=0,be=0;function me(B=0){var x=de+B;if(x>be){var c=Math.ceil((x-be)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${c}MB`)}de=x}return fe.resetMaxMemoryUsage=function(B){de=0,be=B},fe.getBytesAllocated=function(){return de},fe.requestMemoryAllocation=me,fe}();typeof Ke<"u"?Ke.exports=Ur:typeof window<"u"&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].decode=Ur);function Ur(n,t={}){var l={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},u={...l,...t},g=new Uint8Array(n),A=new Ne;A.opts=u,Ne.resetMaxMemoryUsage(u.maxMemoryUsageInMB*1024*1024),A.parse(g);var T=u.formatAsRGBA?4:3,Q=A.width*A.height*T;try{Ne.requestMemoryAllocation(Q);var I={width:A.width,height:A.height,exifBuffer:A.exifBuffer,data:u.useTArray?new Uint8Array(Q):Buffer.alloc(Q)};A.comments.length>0&&(I.comments=A.comments)}catch(K){throw K instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+Q):K instanceof ReferenceError&&K.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):K}return A.copyToImageData(I,u.formatAsRGBA),I}});var Er=Ze((s0,Ar)=>{"use strict";var Gr=Mr(),Qr=Pr();Ar.exports={encode:Gr,decode:Qr}});function Nr(n,t={}){let{dprSet:l=[2,3],...u}=t,g=[];if((l||[]).forEach(T=>{u.dpr=T;let Q=Qe(n,u);Q!==g[g.length-1]?.url&&g.push({dpr:T,url:Q})}),t.asArray)return g;let A=g.map(T=>`${T.url} ${T.dpr}x`);return A.length>1?A.join(", "):void 0}function kr(n){return Math.floor(Math.log10(n)*10)}var Cr,jr,Re,Ye,ze,pr,Jr,Tr,Zr,Lr,Qe,Kr,zr,e0,r0,c0,n0=ur(()=>{"use strict";Sr();Br();wr();Cr=_r(Er()),jr=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.homepageRewrite),Re=!!(typeof window<"u"&&window.viewerConfig&&window.viewerConfig.isDownloadedSource)&&!jr,Ye=n=>Me.allowedLambdaExt.includes(n),ze=n=>!!(!Re&&n&&n.lambdaUrl&&Ye(n.type)),pr=(n,t)=>{switch(t){case"video":case"slideshow":return!!(!Re&&n&&n.url&&Ye(n.type));case"background":return!!(!Re&&n&&(n.url||n.finalUrl)&&Ye(n.type));default:return!!(!Re&&n&&(n.unscaledUrl||n.unscaledOptimizedUrl)&&Ye(n.type))}},Jr=n=>!!(n&&n.lqipUrl||ze(n)),Tr=(n={})=>{let{width:t,height:l,cropX:u,cropY:g,cropW:A,cropH:T,originalW:Q=9999,originalH:I=9999,quality:K,ext:fe,scale:O,animationScale:X,isStretched:ce,dpr:he,lossless:de,nearLossless:be,fit:me="none"}=n,B=typeof window<"u"&&window.devicePixelRatio||Me.minDpr,x=he||(B<Me.minDpr?Me.minDpr:B),c=[],a=Math.max(O||1,1),E=X||1;if(!ce&&t){let i=Math.min(Math.round(t*x*a*E),Q);i<Q&&c.push(`w=${i}`)}if(!ce&&!t&&l){let i=Math.min(Math.round(l*x*a*E),I);i<I&&c.push(`h=${i}`)}if(K&&c.push(`q=${K}`),fe&&c.push(`e=${fe}`),de&&c.push("ll=true"),be&&c.push("nll=true"),me==="auto"&&t&&l){let i=Math.min(Math.round(l*x*a*E),I);i<I&&c.push(`h=${i}`)}return u!==void 0&&g!==void 0&&A&&T&&(A!==Q||T!==I)&&(c.push(`cX=${u}`),c.push(`cY=${g}`),c.push(`cW=${A}`),c.push(`cH=${T}`)),c.length?`?${c.join("&")}`:""},Zr=n=>{if(!n)return"";try{let t=new URL(n.unscaledUrl||n.url||n.unscaledOptimizedUrl||n.finalUrl||"");return`${Me.readymag_lambda_host}${t.pathname}`}catch{return""}},Lr=n=>n?`${n.lambdaUrl||Zr(n)}`:"",Qe=(n,t={})=>{if(!n)return"";let l={...t};return pr(n)&&!ze(n)&&(l.cropX=void 0,l.cropY=void 0,l.cropW=t.originalW,l.cropH=t.originalH),hr.isSupported("webp")&&(l.ext="webp",n.type==="png"&&(l.nearLossless=!0)),`${Lr(n)}${Tr(l)}`};Kr=(n,t={})=>{if(!n)return"";if(n.lqipUrl)return n.lqipUrl;let l={dpr:1,width:Me.lqipWidth,quality:Me.lqipQuality,...t};return Qe(n,l)},zr=(n,t={})=>{if(!n)return"";let l={width:Me.THUMB_SIZE,height:Me.THUMB_SIZE,quality:Me.THUMB_QUALITY,fit:"auto",...t};return Qe(n,l)},e0=async n=>{let t=new Image;t.src=n,await t.decode();let l=kr(t.width),u=Math.floor(t.height*(l/t.width)),g=document.createElement("canvas");g.width=l,g.height=u;let A=g.getContext("2d");A?.drawImage(t,0,0,l,u);let T=A?.getImageData(0,0,l,u);return T?br(T.data,T.width,T.height,4,4):""},r0=(n,t,l)=>{let u=kr(t),g=Math.floor(l*(u/t)),A=gr(n,u,g);if(typeof window<"u"){let T=document.createElement("canvas");T.width=u,T.height=g;let Q=T.getContext("2d"),I=Q?.createImageData(u,g);return I?(I?.data.set(A),Q?.putImageData(I,0,0),T.toDataURL("image/jpeg")):""}else{let T="data:image/jpeg;base64,",Q=Cr.default.encode({data:A,width:u,height:g});return T+Q.data.toString("base64")}};c0={isDownloadedSource:Re,allowedLambdaExt:Ye,useLambdaUrl:ze,useLambdaUrlOldProjects:pr,useLqipUrl:Jr,getLambdaUrl:Qe,getOriginalLambdaUrl:Lr,getLambdaParams:Tr,getSrcset:Nr,getLqipUrl:Kr,getThumbnailUrl:zr,encodeBlurHash:e0,decodeBlurHash:r0}});export{c0 as a,n0 as b};
