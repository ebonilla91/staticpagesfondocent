import{a as Ze,b as Xo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-EDUIUGAV.js";import{a as nt,b as Qo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-CBJ3GPOZ.js";import{b as rt,k as Zo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-TVFWAXKI.js";import{c as st,d as it,e as at,f as lt,h as dt,j as gt,o as ct,p as en}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-UKAV2MTG.js";import{a as tt,b as ot}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-GVRHK2QQ.js";import{a as me,b as et}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-Z63DEK6E.js";import{a as Yo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-V2UNE6ZB.js";import{F as Pe,G as m,H as S,J as V}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-BPJUKUAP.js";import{a as w,b as Q}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-3ZELX36Q.js";import{c as H,g as L,h as He,i as v,j as pe,n as ue,o as Qe}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-PJF6UIFY.js";import{l as Ye,q as Ko}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-QQSGI2X4.js";import{a as Xe,c as Jo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-MKQKZXV6.js";import{a as De}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-WSIFDYHJ.js";import{b as re,c as qo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-OAY73AJW.js";import{b as $o}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-BWC6YUQZ.js";import{a as Vo}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-L5GBYYT7.js";import{a as R,d as ne,f as ce}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-IDSWT3EJ.js";var Te=R(()=>{"use strict"});function C({children:e}){return m(Le.default,{textStyle:"small",children:e})}function A({children:e}){return m(Le.default,{textStyle:"small",fontStyle:"italic",children:e})}var Le,pt=R(()=>{"use strict";Le=ne(Yo());V()});var F,W,mt,Pt=R(()=>{"use strict";pt();Te();V();F={TextWidget:S(C,{children:["Click on the ",m(A,{children:"plus"})," in the lower-left panel and choose a Text widget"]}),TextWidgetOpenPanel:"Select the text widget to get back on track",PictureWidgetSelect:S(C,{children:["Click on the ",m(A,{children:"plus"})," in the lower-left panel and add a Picture widget"]}),PictureWidgetUse:"Select the picture widget again",ButtonWidgetSelect:S(C,{children:["Click on the plus and choose a ",m(A,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Select the button widget you added earlier",ButtonWidgetAddLink:"Select the button widget you added earlier",CreateLayout:S(C,{children:["\u0421lick the ",m(A,{children:"Devices"})," icon to add a mobile layout"]}),CreateLayoutSelect:S(C,{children:["\u0421lick the ",m(A,{children:"Devices"})," icon to add a mobile layout"]})},W={TextWidget:S(C,{children:["First, let\u2019s learn how to work with text blocks. Click here to add a ",m(A,{children:"Text"})," widget"]}),TextWidgetOpenPanel:S(C,{children:["Now open the ",m(A,{children:"Typography"})," panel"]}),TextWidgetProperties:"Change the font size to 24",TextWidgetSelect:m(C,{children:"Let\u2019s say you want to finish text editing\u2014just click on any empty area"}),TextWidgetDrag:m(C,{children:"Now drag the text to the left side of the page"}),PictureWidget:S(C,{children:["You\u2019re off to a good start! Now click on the ",m(A,{children:"plus"})," to start adding a picture"]}),PictureWidgetSelect:S(C,{children:["Choose a ",m(A,{children:"Picture"})," widget"]}),PictureWidgetUse:"Click on the Unsplash icon and choose a random picture",PictureWidgetClickOutside:"Now let\u2019s align this widget to the grid. Click on the empty area",SelectGrids:S(C,{children:["Then select ",m(A,{children:"Grid & Guides"})]}),ChangeGrids:S(C,{children:["The 3 dots on the right top of the settings correspond to 3 grid presets",m("br",{}),"Click on the last dot"]}),PictureWidgetPlace:"Move it around the page to align to the grid",TurnOffGuides:S(C,{children:["Disable the guides by pressing the ",m(A,{children:"H"})," key"]}),PageHeight:S(C,{children:["Now we\u2019ll decrease the page height.",m("br",{}),"Scroll down and drag the ",m(A,{children:"Blue Diamond"})," up"]}),ButtonWidget:S(C,{children:["Well done, now let\u2019s add a button. Click on the ",m(A,{children:"plus"})," first"]}),ButtonWidgetSelect:S(C,{children:["Choose a ",m(A,{children:"Button"})," widget"]}),ButtonWidgetAdjustVisualProperties:"Change the button color to black",ButtonWidgetAddLink:"Then add a link to the button",CreateLayout:S(C,{children:["Now let\u2019s see how your design looks in the mobile version",m("br",{}),"Click on the ",m(A,{children:"Devices"})," icon"]}),CreateLayoutSelect:S(C,{children:["Click on the ",m(A,{children:"plus"})," at the top of the Devices panel"]}),AdjustSizes:"It\u2019s time to add the finishing touch. Swap the picture with the text widget",ArrangeMobile:S(C,{children:["Click ",m(A,{children:"Single column"})," to arrange a mobile version"]}),PreviewAndPublish:S(C,{children:["Last step! Click on the ",m(A,{children:"Eye"})," icon to preview your project before publishing"]}),BackToConstructor:S(C,{children:["Hit ",m(A,{children:"Publish"})," or click the pencil icon to go back to the editor"]})},mt={TextWidget:{name:"TextWidget",text:W.TextWidget,num:1,nextStep:"TextWidgetOpenPanel",widgetSelectionType:"text",fallbackText:F.TextWidget},TextWidgetOpenPanel:{name:"TextWidgetOpenPanel",text:W.TextWidgetOpenPanel,num:2,prevStep:"TextWidget",nextStep:"TextWidgetProperties",fallbackText:F.TextWidgetOpenPanel},TextWidgetProperties:{name:"TextWidgetProperties",text:W.TextWidgetProperties,num:3,prevStep:"TextWidgetOpenPanel",nextStep:"TextWidgetSelect",fallbackText:F.TextWidgetOpenPanel},TextWidgetSelect:{name:"TextWidgetSelect",text:W.TextWidgetSelect,num:4,prevStep:"TextWidgetProperties",nextStep:"TextWidgetDrag"},TextWidgetDrag:{name:"TextWidgetDrag",text:W.TextWidgetDrag,num:5,prevStep:"TextWidgetSelect",nextStep:"PictureWidget"},PictureWidget:{name:"PictureWidget",text:W.PictureWidget,num:6,prevStep:"TextWidgetDrag",nextStep:"PictureWidgetSelect",fallbackStep:"SelectGrids",widgetSelectionType:"picture"},PictureWidgetSelect:{name:"PictureWidgetSelect",text:W.PictureWidgetSelect,num:7,prevStep:"PictureWidget",nextStep:"PictureWidgetUse",widgetSelectionType:"picture",fallbackText:F.PictureWidgetSelect},PictureWidgetUse:{name:"PictureWidgetUse",text:W.PictureWidgetUse,num:8,prevStep:"PictureWidgetSelect",nextStep:"PictureWidgetClickOutside",fallbackText:F.PictureWidgetUse},PictureWidgetClickOutside:{name:"PictureWidgetClickOutside",text:W.PictureWidgetClickOutside,num:9,prevStep:"PictureWidgetUse",nextStep:"SelectGrids",fallbackStep:"SelectGrids"},SelectGrids:{name:"SelectGrids",text:W.SelectGrids,num:10,prevStep:"PictureWidgetClickOutside",nextStep:"ChangeGrids"},ChangeGrids:{name:"ChangeGrids",text:W.ChangeGrids,num:11,prevStep:"SelectGrids",nextStep:"PictureWidgetPlace"},PictureWidgetPlace:{name:"PictureWidgetPlace",text:W.PictureWidgetPlace,num:12,prevStep:"ChangeGrids",nextStep:"TurnOffGuides"},TurnOffGuides:{name:"TurnOffGuides",text:W.TurnOffGuides,num:13,prevStep:"PictureWidgetPlace",nextStep:"PageHeight"},PageHeight:{name:"PageHeight",text:W.PageHeight,num:14,prevStep:"TurnOffGuides",nextStep:"ButtonWidget"},ButtonWidget:{name:"ButtonWidget",text:W.ButtonWidget,num:15,prevStep:"PageHeight",nextStep:"ButtonWidgetSelect"},ButtonWidgetSelect:{name:"ButtonWidgetSelect",text:W.ButtonWidgetSelect,num:16,prevStep:"ButtonWidget",nextStep:"ButtonWidgetAdjustVisualProperties",widgetSelectionType:"button",fallbackText:F.ButtonWidgetSelect},ButtonWidgetAdjustVisualProperties:{name:"ButtonWidgetAdjustVisualProperties",text:W.ButtonWidgetAdjustVisualProperties,num:17,prevStep:"ButtonWidgetSelect",nextStep:"ButtonWidgetAddLink",fallbackText:F.ButtonWidgetAdjustVisualProperties},ButtonWidgetAddLink:{name:"ButtonWidgetAddLink",text:W.ButtonWidgetAddLink,num:18,prevStep:"ButtonWidgetAdjustVisualProperties",nextStep:"CreateLayout",fallbackText:F.ButtonWidgetAddLink},CreateLayout:{name:"CreateLayout",text:W.CreateLayout,num:19,prevStep:"ButtonWidgetAddLink",nextStep:"CreateLayoutSelect",fallbackText:F.CreateLayout},CreateLayoutSelect:{name:"CreateLayoutSelect",text:W.CreateLayoutSelect,num:20,prevStep:"CreateLayout",nextStep:"ArrangeMobile",fallbackText:F.CreateLayoutSelect},ArrangeMobile:{name:"ArrangeMobile",text:W.ArrangeMobile,num:21,prevStep:"CreateLayoutSelect",nextStep:"PreviewAndPublish"},PreviewAndPublish:{name:"PreviewAndPublish",text:W.PreviewAndPublish,num:22,prevStep:"ArrangeMobile",nextStep:"BackToConstructor"},BackToConstructor:{name:"BackToConstructor",text:W.BackToConstructor,num:23,prevStep:"PreviewAndPublish"}}});var he,Tt=R(()=>{"use strict";Te();Pt();he={0:mt}});var ht,ft=R(()=>{"use strict";Q();ht=()=>{w.post("/api/mailchimp/help-tour-not-finished")}});var bt,Ge,on,St,nn,rn,j,Xn,Yn,J,wt,Qn,Zn,sn,an,er,tr,or,nr,fe,yt=R(()=>{"use strict";et();Qe();He();pe();Tt();Te();ft();Fe();bt={tourType:0,modalStatus:"unshow",started:!1,waiting:!1,showNotice:!1,step:null,totalSteps:0},Ge=new Set,on=()=>{let e=window.RM.constructorRouter?.me,t=e?.get("behavior_metrics")||{};if(!t||!e)return;let s={...t,constructor_tour_finished:!0};e.save({behavior_metrics:s},{patch:!0})},St=(e,t)=>t?Array.isArray(e)?e.includes(t.name):t.name===e:!1,[nn,rn,j,Xn]=me(bt),Yn=()=>nn({hookType:"layout"}),J=e=>{rn(e),v.trigger("helptour:update",e)},wt=e=>{let t=j();J({...t,modalStatus:e})},Qn=(e=0)=>{let{started:t}=j();if(t)return;let s=Object.values(he[e]),l=s[0];J({tourType:e,modalStatus:"unshow",started:!0,waiting:!1,showNotice:!1,step:l,totalSteps:s.length}),L.sendAmplitudeEvent(H.HelpTour,{status:"started"})},Zn=()=>{let{started:e}=j();e&&wt("closing")},sn=()=>{let{started:e,step:t,totalSteps:s}=j();if(!e||!t){setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerMetrics","helpTourSkipped")},1e3);return}Ge.clear(),J(bt),t?.num<s&&ht()},an=e=>{let{step:t}=j();sn(),wt("end"),e?.(),L.sendAmplitudeEvent(H.HelpTourProgress,{step:t?.num}),L.sendAmplitudeEvent(H.HelpTour,{status:"finished"}),on()},er=(e,t)=>{let s=j(),{step:l,started:c,tourType:u,totalSteps:d}=s;if(!c)return;if(!l?.nextStep){an(t?.cb);return}let y=(Array.isArray(e)?e:[e]).includes(l.name),O=t?.fallback;if(!y||O&&!l.fallbackStep)return;let I=O&&l.fallbackStep?l.fallbackStep:l.nextStep,f=he[u][I];f&&(J({...s,waiting:!1,showNotice:!1,step:f}),ue.requestIdleCallback(()=>{for(let P=1;P<=d&&!(P>l.num);P++)P<=l.num&&!Ge.has(P)&&(L.sendAmplitudeEvent(H.HelpTourProgress,{step:P}),Ge.add(P))}))},tr=e=>{let t=j(),{step:s,started:l,tourType:c}=t;if(!l||!s?.prevStep||!(Array.isArray(e)?e:[e]).includes(s.name))return;let T=he[c][s.prevStep];T&&J({...t,waiting:!1,showNotice:!1,step:T})},or=e=>{let t=j(),{step:s,started:l}=t;!l||!St(e,s)||J({...t,waiting:!0})},nr=(e,t)=>{let s=j(),{step:l,started:c,showNotice:u}=s;!c||!St(e,l)||J({...s,showNotice:t.show??!u})},fe=()=>j().started});var be,ln,dn,xt=R(()=>{"use strict";be=(e,t,s,l)=>{let c=s.findIndex(y=>y.num===e),u=c>=0?s[c]:null,d=e+1,T=null;if(u&&u.children&&u.children.length)if(l[u._id]&&l[u._id].collapsed)T=u._id;else{let y=s[c+1];y?d=y.num:d=u.children[u.children.length-1].num+1}if(!u){let y=t.find(O=>O.num===e);y&&(T=y.parentPage)}return{newPageNum:d,newPageParentId:T}},ln=(e,t=void 0)=>e.map(s=>s.children?{id:s._id,parentId:t,items:ln(s.children,s._id)}:{id:s._id,parentId:t}),dn=e=>e.reduce((t,s)=>(t.push(s),s.items?t.concat(dn(s.items)):t),[])});var U,vt=R(()=>{"use strict";U=class{constructor({message:t,tag:s,type:l}){ce(this,"message");ce(this,"type");ce(this,"tag");this.message=t,this.tag=s,this.type=l||"error"}}});var Ct,Wt,dr,Mt=R(()=>{"use strict";Q();Ct=e=>w.get(`/api/user/${e}/links`),Wt=e=>w.get(`/api/user/${e}/projects-domains`),dr=(e,t)=>w.post("/api/checkdomain",{type:e,domain:t})});var pr,ur,Ot,mr,kt=R(()=>{"use strict";Q();pr=()=>w.get("/api/user_templates/"),ur=async()=>{let{data:e}=await w.get("/api/help-tour-template/");return e||{}},Ot=e=>w.delete("/api/template/",{id:e}),mr=(e,t)=>w.put("/api/template/",{id:e,name:t})});var At,_t,It,hr,Nt=R(()=>{"use strict";Q();At=(e,t)=>w.post("/api/checkdomain",{num_id:e,domain:t}),_t=(e,t)=>w.post(`/api/mag/domain/${e}`,{domain:t,status:"on"}),It=e=>w.post(`/api/mag/domain/${e}`,{status:"off"}),hr=e=>w.post("/api/domain/visit",{domain:e})});var Sr,wr,yr,xr,Rt,Et,Ut=R(()=>{"use strict";Q();Sr=async({email:e,projectNumIds:t,folderIds:s,sharesAll:l,role:c,folderRoles:u,projectRoles:d})=>{let T=await w.post("/api/team",{email:e,mags:t,folders:s,sharesAll:l,role:c,folderRoles:u,projectRoles:d});if(!T.teamMember)throw T.error||T;return T.teamMember},wr=async({email:e,projectNumIds:t,folderIds:s,sharesAll:l,role:c,folderRoles:u,projectRoles:d})=>{let T=await w.put("/api/team",{email:e,mags:t,folders:s,sharesAll:l,role:c,folderRoles:u,projectRoles:d});if(!T.teamMember)throw T.error||T;return T.teamMember},yr=e=>w.delete("/api/team",{email:e}),xr=e=>w.post("/api/team/invite",{email:e}),Rt=()=>w.get("/api/team"),Et=(e,t={isPending:!1})=>{let s=new URLSearchParams(t);return w.get(`/api/project/${e}/team${s.toString()?"?"+s:""}`)}});function Yr({project:e,router:t,inPreview:s,children:l}){let c=(0,i.useCallback)(o=>{let n={...o.attributes};return delete n.children,n},[]),[u,d]=(0,i.useState)(()=>{let o=e.pages.models.map(r=>c(r));o.sort((r,a)=>r.num-a.num);let n=we(o,null);return{project:e.attributes,owner:e.user.attributes,isOwner:!!t.isOwner,inPreview:!!s,pages:o,trashPages:[],pageRecentlyDeleted:!1,userTemplates:[],currentPageNum:t.getCurrentPageNum(),currentPageId:t.getCurrentPageId(),pagesTree:n,pagesParams:Se(n,{}),codeInjectUpgradeAlertShown:!1,publishInProgress:!1,unpublishInProgress:!1,isPublishError:!1,selectedPages:[],lockedPages:{},collaborators:[],team:[],allProjects:[],teamworkProjects:[],ownedProjectTeam:[],projectTeam:[],me:t.me.attributes}}),{pages:T,pagesTree:y,pagesParams:O,project:{user:I,opts:f,num_id:P,domain:k},currentPageId:N,currentPageNum:B,publishInProgress:M,unpublishInProgress:E,isOwner:$,me:K}=u,X=(0,i.useCallback)(o=>{let n=t.pageOrder.get("order"),r=null;if(o>n.length)r=n[n.length-1].id;else{let a=n.find(g=>g.num===o);a&&(r=a.id)}r?t.showWorkspace({id:r}):t.showWorkspace({num:1})},[t]),$e=(0,i.useCallback)((o,n)=>{let r=n.findIndex(a=>a._id===o.get("_id"));if(r>=0){let a=[...n];return a[r]&&(a[r]=c(o)),a}return n},[c]),Z=(0,i.useRef)(void 0),Y=(0,i.useCallback)((o,n={})=>{Z.current&&(Z.current.hide(),Z.current.remove()),Z.current=new Ze({$parent:document.querySelector("body > .popups"),router:t,opts:{type:"type-more-pages",is_contributor:!t.isOwner,owner_email:I?I.email:"",...n},alert_source:o}),Z.current.render()},[I,t]),qe=(0,i.useCallback)(()=>{d(o=>({...o,pageRecentlyDeleted:!1}))},[]),ve=(0,i.useRef)(void 0),Je=(0,i.useCallback)(()=>{d(o=>({...o,pageRecentlyDeleted:!0})),ve.current&&clearTimeout(ve.current),ve.current=setTimeout(()=>{qe()},4500)},[qe]),ee=(0,i.useCallback)((o,n)=>e.set(o,n),[e]),ie=(0,i.useCallback)((o,n)=>e.unset(o,n),[e]),Xt=(0,i.useCallback)((o,n)=>e.save(o,n),[e]),Yt=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.set(n,r)},[e]),Qt=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.unset(n,r)},[e]),Ce=(0,i.useCallback)((o,n,r)=>{let a=e.pages.get(o);if(!a)throw new Error("Element not found");return a.save(n,r)},[e]),Zt=(0,i.useCallback)(o=>{d(n=>({...n,currentPageNum:o}))},[]),Ke=(0,i.useCallback)(o=>{d(n=>({...n,inPreview:o}))},[]),eo=(0,i.useCallback)((o,n)=>{d(r=>({...r,pagesParams:{...r.pagesParams,[o]:{...r.pagesParams[o],collapsed:n}}}))},[]),te=(0,i.useCallback)(async o=>{await e.pages.find(r=>r.attributes._id===o).updateScreenshots(e.get("num_id"))},[e]),to=(0,i.useCallback)((o,n,r)=>new Promise((a,g)=>{let{newPageNum:b,newPageParentId:h}=be(o,T,y,O),x=t.workspace.page.get("order")?.default,G={num:b};n&&(G={...G,...n}),e.addPage(G,ge=>{if(ge&&ge.err)g(ge);else{let D=ge;n?window.RM.constructorRouter.trigger("notice:triggerMetrics","templateUsed"):D.isEmptyPage=!0,D.get("num")===2&&setTimeout(()=>{window.RM.constructorRouter.trigger("notice:triggerEduTip","eduTipUseNavigation",{standAlone:!0})},0),D.set("parentPage",h),t.pageOrder.reorderPagesAfterAdd({page:D,magId:e.get("_id")}),e.onAdd(D),n&&(D.from_template=!0,D.hasGlobalWidgets()&&(e.addGlobalWidgetsFromTemplate(D),e.pages.map(oe=>oe.attributes._id).filter(oe=>oe!==D.id).forEach(oe=>te(oe)))),r||t.showWorkspace({id:D.id}),a(D)}},!0,x)}),[t,e,T,y,O,te]),oo=(0,i.useCallback)(o=>new Promise((n,r)=>{let a=e.getPage(o);if(!a)return r(new Error("Could not find page"));a.get("mid")||a.save({mid:e.get("_id")},{silent:!0});let{newPageNum:g,newPageParentId:b}=be(a.get("num"),T,y,O);a.duplicate(h=>{if(h instanceof Error)return h.message==="Server error: permission_denied"&&(ae()?t.trigger("notice:show","unpauseSubscriptionToCreatePage",{canBeClosed:!0}):Y("duplicate page",{type:"type-more-pages"})),r(h);let p=h;p.set("parentPage",b),t.pageOrder.reorderPagesAfterAdd({page:p,magId:e.get("_id")}),e.onAdd(p),t.gg.guides?.model&&(t.gg.guides.model.addPage(p.id,{silent:t.gg.guides.hidden}),t.gg.guides.model.save()),t.showWorkspace({id:p.id}),n(h)},{num:g})}),[t,e,T,y,O,Y]),no=(0,i.useCallback)(async()=>{let o=t._pageChanged;o&&typeof o=="string"&&(t._pageChanged=!1,await te(o))},[t,te]),ro=(0,i.useCallback)(o=>new Promise((n,r)=>{t.pageOrder.saveInProgress()||(t.pageOrder.save({order:o,mid:t.mag.id},{success:()=>{e.trigger("change:pids",e,e.get("pids")),n()},error:r}),e.trigger("change:pids",e,e.get("pids")))}),[t,e]),so=(0,i.useCallback)(o=>new Promise((n,r)=>{if(t.isPageLocked(o))return r(new Error("This page is locked"));if(e.get("pids").length===1)return r(new Error("Can't delete last page"));let a=O[o],g=[];if(a&&a.children.length){let p=a.children;a.collapsed?t.pageOrder.removeParentIds(p):g=[...p]}if(g.push(o),!e.checkDeletingPages(g))return r(new Error("Can't delete all pages"));let b=g.includes(N),h=B;t.pageOrder.deletePagesFromOrder(g,e.get("_id")).then(()=>{e.deletePages(g,p=>{p instanceof Error?(t.pageOrder.load(e),r(p)):p&&p.deleteNotEmptyPages&&Je(),b?X(h):t.triggerPageChange(),g.forEach(x=>t.removeWorkspace(x)),n({deleted:g})})},(p,x)=>{r(new Error(x))})}),[t,e,O,N,B,Je,X]),io=(0,i.useCallback)(o=>new Promise((n,r)=>{e.restorePage(o,{success:a=>{let g=t.workspace.getPageNum();if(!g)throw"Unable to get current page number";let{newPageNum:b,newPageParentId:h}=be(g,T,y,O);a.set("num",b),a.set("parentPage",h),t.pageOrder.reorderPagesAfterAdd({page:a,magId:e.get("_id")}),e.onAdd(a),e.save(),t.showWorkspace({id:a.id}),n(a)},error:a=>{let g=JSON.parse(a.responseText);g.err==="permission_denied"&&Y("restore page",{type:"type-more-pages"}),r(g)}},!0)}),[t,e,T,y,O,Y]),ao=(0,i.useCallback)(o=>e.deleteTrashPages(o),[e]),lo=(0,i.useCallback)(()=>new Promise(o=>{e.get("has_deleted_pages")?e.fetchTrashPages().then(n=>{n&&d(r=>({...r,trashPages:n})),o(n)}):o([])}),[e]),go=(0,i.useCallback)(()=>e.emptyTrash().then(()=>{d(o=>({...o,trashPages:[]}))}),[e]),co=(0,i.useCallback)(()=>e.loadUserTemplates().then(o=>(Array.isArray(o)&&d(n=>({...n,userTemplates:o})),o)),[e]),po=(0,i.useCallback)(()=>e.hasGlobalWidgets(),[e]),uo=(0,i.useCallback)((o={})=>t.createTemplateFromCurrentPage(o).then(n=>(n&&d(r=>{let a=Array.from(r.userTemplates);return a.unshift(n),{...r,userTemplates:a}}),n)).catch(n=>{throw n&&n.message==="permission denied"&&Y("create user template",{type:"type-more-pages"}),n}),[t,Y]),mo=(0,i.useCallback)(o=>Ot(o).then(()=>{d(n=>({...n,userTemplates:n.userTemplates.filter(r=>r.id!==o)}))}),[]),Po=(0,i.useCallback)((o,n)=>{let r={hyphen:"The link should not start or end with a hyphen",onlyNumbers:"The link should not consist of digits only",uriLength:"The link should be less than 128 characters long",used:"You already have a page with this link",pageNotFound:"Can't find current page"},a=e.getPage(o);if(a){let g=a.validate({uri:n,parentPage:a.get("parentPage")});return g?r[Object.keys(g)[0]]:void 0}else return r.pageNotFound},[e]),We=(0,i.useCallback)(async()=>{let o=e.getUsedFonts({includeCustom:!0,excludeUnusedDefault:!0}),n=nt.sortFontsByProvider(o);return lt(e.id,n,!0)},[e]),To=(0,i.useCallback)(async(o={})=>{let n=e.get("user").permissions||{},r=rt(re.environment.preview,e.getAllWidgets()),a=K?.plan?.level,g;a==="personal"||a==="freelancer"?g="Please upgrade account to publish another project. Check out the pricing to learn more.":g="Please upgrade your plan to publish more than one project.";let b="Injected Code, Forms and Shots will not work in Published project.";if(n.can_publish){if(r&&!n.can_use_e_commerce)throw new U({message:"Please upgrade your account to publish project with ecommerce.",tag:"type-publish-ecommerce"});if(e.hasCodeInjection()&&!t.me?.get("permissions")?.can_inject_code&&!o.skipWarnings)throw new U({message:b,tag:"type-code-injection",type:"warning"});if(e.hasWidgetsWithType("shots")&&!t.me?.get("permissions")?.can_use_shots&&!o.skipWarnings)throw new U({message:b,tag:"type-widget-shots",type:"warning"});if(e.hasWidgetsWithType("form")&&!t.me?.get("permissions")?.can_use_forms&&!o.skipWarnings)throw new U({message:b,tag:"type-widget-shots",type:"warning"})}else{let h=n._reasons||{},p=h.can_publish&&h.can_publish.code;throw new U({message:ae()?"You can't publish another project. Your subscription has been paused":p==="reason_publish_limit"?g:"Please verify your email address to publish this project.",tag:ae()?"type-publish-paused-subcription":p==="reason_publish_limit"?"type-publish-limit":"type-publish-noemail"})}if(!M){d(h=>(L.sendAmplitudeEvent(H.Publish,{firstTime:!e.get("is_published"),zone:`editor ${h.inPreview?"preview":"project settings"}`}),{...h,publishInProgress:!0})),o.alsoExport&&I.permissions.can_export_template&&t.exportMagAsTemplateset(o.dontRenewScreenshots);try{await We();let h=await st(e.get("num_id"));e.set({...e.parse(h),changed:!1}),d(p=>({...p,publishInProgress:!1}))}catch{d(p=>({...p,publishInProgress:!1,isPublishError:!0})),await new Promise(p=>setTimeout(p,5e3)),d(p=>({...p,isPublishError:!1}))}}},[t,e,K,I,M,We]),ho=(0,i.useCallback)(async()=>{E||(d(o=>({...o,unpublishInProgress:!0})),await at(e.get("num_id")),e.set({is_published:null,published:null,updated:null}),d(o=>({...o,unpublishInProgress:!1})))},[e,E]),fo=(0,i.useCallback)(async()=>{await it(e.get("num_id")),window.location.reload()},[e]),q=(0,i.useCallback)(o=>t.me&&t.me.get("permissions")[o],[t]),ae=(0,i.useCallback)(()=>t.me?.get("permissions")?._reasons?.limited_usage?.code==="reason_subscription_paused",[t]),bo=(0,i.useCallback)(()=>{if(!q("can_export_pdf"))throw new U({message:S(Pe,{children:["Please upgrade your account",m("br",{}),"to export the project to PDF.",m("br",{}),m("a",{href:`${re.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"})]}),tag:"type-export-pdf"})},[q]),So=(0,i.useCallback)(()=>{if(!q("can_export_code"))throw new U({message:S(Pe,{children:["Please upgrade your account",m("br",{}),"in order to export the source",m("br",{}),"code of your projects.",m("br",{}),m("a",{href:`${re.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-export-code"})},[q]),wo=(0,i.useCallback)(()=>{if(!q("can_use_iframe"))throw new U({message:S(Pe,{children:["Please upgrade your account",m("br",{}),"in order to use iframe",m("br",{}),"for your projects.",m("br",{}),m("a",{href:`${re.readymag_host}/pricing`,target:"_blank",rel:"noopener noreferrer",className:"learn-more",children:"See the pricing"}),"."]}),tag:"type-iframe-code"})},[q]),yo=(0,i.useCallback)(()=>{t.openCodeEditor()},[t]),xo=(0,i.useCallback)(()=>["ci_head","ci_css","ci_body_top","ci_body_bottom"].some(o=>!!u.project[o]),[u.project]),vo=(0,i.useCallback)(()=>e.hasCodeInjection(),[e]),Co=(0,i.useCallback)(()=>e.hasWidgetsWithType("shots"),[e]),Wo=(0,i.useCallback)(()=>e.hasWidgetsWithType("form"),[e]),Mo=(0,i.useCallback)(o=>{d(n=>{let r=n.lastSelectedPage&&n.selectedPages.includes(n.lastSelectedPage)?n.lastSelectedPage:t.getCurrentPageId();if(r){let a=n.pagesTree.reduce((x,G)=>(x.push(G),G.children?ue.pushArray(x,G.children):x),[]),g=a.findIndex(x=>x._id===o),b=a.findIndex(x=>x._id===r),h=a.slice(Math.min(g,b),Math.max(g,b)+1).map(x=>x._id).filter(x=>!n.selectedPages.includes(x)),p=[...n.selectedPages,...h];return{...n,selectedPages:p,lastSelectedPage:o}}return{...n,lastSelectedPage:o}})},[t]),Oo=(0,i.useCallback)(o=>{d(n=>{let r=[...n.selectedPages];return r.includes(o)?r.splice(r.indexOf(o),1):r.push(o),{...n,selectedPages:r,lastSelectedPage:o}})},[]),ko=(0,i.useCallback)(()=>{d(o=>({...o,selectedPages:[]}))},[]),Ao=(0,i.useCallback)(()=>{if(!$)return;let o=t.getCurrentPageId(),n=e.pages.find(r=>r.attributes._id===o);t.unlockPage(n)},[t,e,$]),_o=(0,i.useCallback)(()=>{t.updateUrl(),t.triggerPageChange()},[t]),Io=(0,i.useCallback)(o=>{t.getCurrentPageId()!==o.id&&t.showWorkspace(o)},[t]),Me=(0,i.useCallback)(async o=>{let[n,r]=await Promise.all([Rt(),Et(o,{})]),{mags:a}=await w.get("/api/readymags/user");return{team:n,allProjects:a,teamworkProjects:a.filter(g=>g.num_id===o),ownedProjectTeam:n.filter(g=>g.projectNumIds.includes(o)),projectTeam:r}},[]),No=(0,i.useCallback)((o,n)=>{d(r=>({...r,team:o,ownedProjectTeam:o.filter(a=>a.projectNumIds.includes(n))}))},[]),Ro=(0,i.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return Ct(n)},[t]),Eo=(0,i.useCallback)(o=>{let n=o||(t.me?t.me.get("_id"):"");return Wt(n)},[t]),Uo=(0,i.useCallback)(o=>dt({...o,numId:o.numId?o.numId:e.get("num_id")}).then(()=>{let{isPrivate:n,isPrivatePages:r,password:a}=o;e.set({is_private:n,isPrivatePages:r,pass:a!==void 0?a:e.get("pass")})}),[e]),Bo=(0,i.useCallback)((o,n)=>{let r=Ce(o,{isPrivate:n},{patch:!0});r&&!(r instanceof Error)&&r.done(()=>{let a=(g,b,h)=>g.map(p=>(p._id===b&&(p.isPrivate=h),p));d(g=>{let b=a(g.pages,o,n),h=g.pagesTree.map(p=>(p._id===o&&(p.isPrivate=n),p.children&&p.children.length&&(p.children=a(p.children,o,n)),p));return{...g,pages:b,pagesTree:h,pagesParams:Se(h,g.pagesParams)}})})},[Ce]),Do=(0,i.useCallback)(o=>{let n=I.permissions.viewer_opts_overrides||{},a={...e.get("opts"),...o==="phone_portrait"?e.get("viewport_phone_portrait")?.opts||{}:o==="tablet_portrait"?e.get("viewport_tablet_portrait")?.opts||{}:{},...n};return{...a,...e.get("is_private")&&{sharebutton:!1},...!a.menubutton&&{projectinfo:!1}}},[e,I]),le=(0,i.useCallback)((o,n,r)=>{let a=je.default.intersection(Object.keys(o),Ye).length>0,g=r==="phone_portrait"||r==="tablet_portrait",b=a&&g?r:"default",h=Object.keys(o)[0],p={...o,...o.menubutton===!1&&{projectinfo:!1}};if(["arrows","menubutton","projectinfo","sharebutton","pagecounter","controlsontop","controlsontop","branding","slidein","scalableviewer"].includes(h)&&h==="scalableviewer"&&L.sendAmplitudeEvent(H.SettingsViewer,{settingsType:"scale layout"}),b==="phone_portrait"||b==="tablet_portrait"){let x=`viewport_${b}`,G={...e.get(x)?.opts||{},...p};return e.set(x,{...e.get(x)||{},opts:G},n),Bt(e.get("num_id"),G,b)}else{let x={...e.get("opts"),...p};return e.set("opts",x,n),Bt(e.get("num_id"),x,b)}},[e,f]),Ho=(0,i.useCallback)(o=>At(P,o).then(n=>(ee({last_checked_domain:o},{silent:!0}),n)),[P,ee]),Lo=(0,i.useCallback)(o=>_t(P,o).then(()=>{ee({domain:o,domainStatus:"on"})}),[P,ee]),Go=(0,i.useCallback)(()=>It(P).then(o=>(ie("domain"),ie("domainStatus"),o)),[e,k,P,f,ie,le]),Oe=(0,i.useCallback)((o,n)=>{o&&d(r=>{let a=o.pages.models.map(b=>c(b)).filter(b=>n.includes(b._id));a.sort((b,h)=>b.num-h.num);let g=we(a,null);return{...r,project:o.attributes,pages:a,pagesTree:g,pagesParams:Se(g,r.pagesParams)}})},[c]),ke=(0,i.useCallback)(o=>{o&&d(n=>({...n,project:o.attributes}))},[]),Ae=(0,i.useCallback)((o,n,r)=>{o&&(o.changed&&!r?.socketUpdate&&(o.changed.num||o.changed.parentPage)||d(a=>{let g=$e(o,a.pages);g.sort((h,p)=>h.num-p.num);let b=we(g,null);return{...a,pages:g,pagesTree:b,pagesParams:Se(b,a.pagesParams)}}))},[$e]),_e=(0,i.useCallback)(o=>{o&&d(n=>{let r=Array.from(n.trashPages);return r.unshift(o.attributes),{...n,trashPages:r}})},[]),Ie=(0,i.useCallback)(o=>{o&&d(n=>{let r=Array.from(n.trashPages),a=r.findIndex(g=>g._id===o.get("_id"));return a>-1&&r.splice(a,1),{...n,trashPages:r}})},[]);(0,i.useEffect)(()=>{function o(){Me(e.attributes.num_id).then(n=>{d(r=>({...r,...n}))})}return o(),e.on(Dt(),ke),e.on("change:pids",Oe),e.pages.on(Ht(),Ae),e.trashPages.on("add",_e),e.trashPages.on("remove",Ie),v.on("refreshTeamworkData",o),()=>{e.off(Dt(),ke),e.off("change:pids",Oe),e.pages.off(Ht(),Ae),e.trashPages.off("add",_e),e.trashPages.off("remove",Ie),v.off("refreshTeamworkData",o)}},[e,ke,Oe,_e,Ie,Ae,Me]);let Ne=(0,i.useCallback)(o=>Ke(o),[]);(0,i.useEffect)(()=>(t.on("togglePreview",Ne),()=>{t.off("togglePreview",Ne)}),[t,Ne]);let Re=(0,i.useCallback)(o=>{let n=o.getPageNum(),r=o.getPageId();n&&r&&d(a=>({...a,currentPageNum:n,currentPageId:r}))},[]);(0,i.useEffect)(()=>(t.on("pageChange",Re),()=>{t.off("pageChange",Re)}),[t,Re]);let de=(0,i.useCallback)(o=>{d(n=>({...n,currentPageNum:o.num,currentPageId:o._id}))},[]);(0,i.useEffect)(()=>(u.inPreview?t.on("previewPageChange",de):t.off("previewPageChange",de),()=>{t.off("previewPageChange",de)}),[u.inPreview,t,de]);let Ee=(0,i.useCallback)((o,n)=>{d(r=>({...r,lockedPages:{...r.lockedPages,[o]:n}}))},[]),Ue=(0,i.useCallback)(o=>{d(n=>{let{[o]:r,...a}=n.lockedPages;return{...n,lockedPages:a}})},[]),Be=(0,i.useCallback)(({list:o})=>{d(n=>({...n,collaborators:o||[]}))},[]);(0,i.useEffect)(()=>(v.on("page:locked",Ee),v.on("page:unlocked",Ue),v.on("sockets:connect",Be),()=>{v.off("page:locked",Ee),v.off("page:unlocked",Ue),v.off("sockets:connect",Be)}),[Ee,Ue,Be]),(0,i.useEffect)(()=>{f.branding===void 0&&le({branding:f.endpage})},[f,le]);let Fo=(0,i.useCallback)(o=>{let n=u.project.user.permissions.viewer_opts_overrides||{};return{disabled:[...Object.keys(n),...o?.menubutton?[]:["projectinfo"],...u.project.is_private?["sharebutton"]:[],...u.project.user.permissions.must_show_branding?["branding"]:[]],permissionOverrides:n}},[u.project]),jo=(0,i.useCallback)(async(o,n)=>{await ct(o,n),d(r=>({...r,project:{...r.project,allow_iframe_embed:o==="allow"}}))},[]),zo={projectSet:ee,projectUnset:ie,projectSave:Xt,pageSet:Yt,pageUnset:Qt,pageSave:Ce,setCurrentPageNum:Zt,setInPreview:Ke,setPageCollapse:eo,addNewPage:to,duplicatePage:oo,renewLastScreenshot:no,updatePageScreenshot:te,restorePage:io,saveOrder:ro,deletePage:so,deletePagesFromTrash:ao,updateTrash:lo,emptyTrash:go,getUserTemplates:co,hasGlobalWidgets:po,createTemplateFromCurrentPage:uo,deleteUserTemplate:mo,validatePageUri:Po,updateUsedFonts:We,publishWithNotice:To,unpublish:ho,restoreToPublished:fo,checkPDFExportPermission:bo,checkHTMLExportPermission:So,checkIFrameExportPermission:wo,openCodeEditor:yo,hasProjectCode:xo,hasCustomCode:vo,hasShots:Co,hasForms:Wo,hasPermission:q,isSubscriptionPaused:ae,selectPage:Oo,selectPagesRange:Mo,deselectPages:ko,takeOverCurrentPage:Ao,updateUrl:_o,changeWorkspace:Io,loadTeamworkData:Me,updateTeam:No,getProjectOptions:Do,setProjectOptions:le,loadUserProjectsLinks:Ro,getDomainsAmount:Eo,setPrivacy:Uo,setPageIsPrivate:Bo,checkDomain:Ho,mapDomain:Lo,unmapDomain:Go,getProjectPermissionsOverrides:Fo,toggleAllowIframeEmbed:jo};return m(Lt.Provider,{value:{...u,...zo,projectMag:e},children:l})}var i,je,Lt,Bt,we,Se,Dt,Ht,Qr,Gt=R(()=>{"use strict";i=ne(De());He();je=ne(Vo());xt();Q();Xo();Qo();Zo();qo();pe();$o();vt();Ko();Qe();en();Mt();kt();Nt();Ut();ot();Fe();V();Lt=(0,i.createContext)({}),Bt=je.default.throttle(gt,300),we=(e,t)=>{let s=[];for(let l in e)if(e[l].parentPage===t){let c=we(e,e[l]._id),u=Object.assign({},e[l]);c.length&&(u.children=c),s.push(u)}else if(e[l].parentPage===void 0){let c=Object.assign({},e[l]);s.push(c)}return s},Se=(e,t)=>{let s={};return e.forEach((l,c)=>{if(s[l._id]={collapsed:t[l._id]?t[l._id].collapsed:!0,viewNum:c+1,uri:l.uri?l.uri:(c+1).toString(),children:[]},l.children){let u=[];l.children.forEach((d,T)=>{u.push(d._id),s[d._id]={collapsed:t[d._id]?t[d._id].collapsed:!0,viewNum:T+1,uri:d.uri?d.uri:(T+1).toString(),children:[],parentId:l._id}}),s[l._id].children=u}}),s},Dt=()=>["title","description","user","folder","uri","domain","domainStatus","last_checked_domain","has_deleted_pages","master_share_pid","changed","is_published","is_private","isPrivatePages","pass","pass_bg","published","opts","viewport_phone_portrait","viewport_tablet_portrait"].map(t=>`change:${t}`).join(" "),Ht=()=>["num","parentPage","screenshot","viewport_phone_portrait","viewport_tablet_portrait","title","uri","seo","hidden","custom_shares"].map(t=>`change:${t}`).join(" ");Qr=()=>(0,i.useContext)(Lt)});var ze=R(()=>{"use strict"});function ps({magModel:e,router:t,children:s}){let[l,c]=(0,_.useReducer)(un,{router:t,magModel:e},cn),u=(0,_.useCallback)(({pageNumber:P,scrollTop:k}={})=>{let N=t.workspace?.page.get("num");window.RM.constructorRouter.togglePreview({pageNumber:P??N,scrollTop:k}),l.inPreview||window.RM.constructorRouter.trigger("notice:triggerEduTipClose")},[t]);(0,_.useEffect)(()=>{let P=()=>{c({type:"togglePreview"})};return window.RM.constructorRouter.unbindGlobalKeyPress("p",u),window.RM.constructorRouter.bindGlobalKeyPress({key:"p",handler:u}),l.inPreview?(window.RM.constructorRouter.off("previewOpen",P),window.RM.constructorRouter.on("previewClose",P)):(window.RM.constructorRouter.off("previewClose",P),window.RM.constructorRouter.on("previewOpen",P)),()=>{window.RM.constructorRouter.unbindGlobalKeyPress("p",u),window.RM.constructorRouter.off("previewOpen",P),window.RM.constructorRouter.off("previewClose",P)}},[l.inPreview]),(0,_.useEffect)(()=>{localStorage.setItem(Ft,JSON.stringify({gridSize:l.gridSize}))},[l.gridSize]);let d=(0,_.useCallback)(()=>{c({type:"openMagMenu"})},[]),T=(0,_.useCallback)(()=>{c({type:"closeMagMenu"})},[]),y=(0,_.useCallback)((P,k)=>{k.viewertype!==l.magMenuOrientation&&c({type:"setMagMenuOrientation",orientation:k.viewertype}),k.menubutton!==l.magMenuOn&&c({type:"setMagMenu",isOn:k.menubutton}),k.controlsontop!==l.controlsOnTop&&c({type:"setControlsOnTop",onTop:k.controlsontop})},[l.magMenuOrientation,l.magMenuOn,l.controlsOnTop]);(0,_.useEffect)(()=>(v.on("magMenu:open",d),v.on("magMenu:close",T),()=>{v.off("magMenu:open",d),v.off("magMenu:close",T)}),[d,T]),(0,_.useEffect)(()=>(v.listenTo(e,"change:opts",y),()=>{v.stopListening(e,"change:opts",y)}),[y]);let O=(0,_.useCallback)(()=>{c({type:"setReadyToPublish",ready:!0})},[]);(0,_.useEffect)(()=>(v.listenTo(t,"previewMag:load:success",O),()=>{v.stopListening(t,"previewMag:load:success",O)}),[O]);let I=()=>{c({type:"toggleCartSidebarState"})};(0,_.useEffect)(()=>(v.on("ecommerce:cartsidebar:visibility:changed",I),()=>{v.off("ecommerce:cartsidebar:visibility:changed",I)}),[I]);let f=(P,k)=>new Promise((N,B)=>{let M=e.getPage(P);M||N(null),M.save({hidden:k}).done(E=>{N(E)}).fail(E=>{B(E.responseJSON)})});return m(ye.Provider,{value:{...l,dispatch:c,setPageVisibility:f,togglePreview:u},children:s})}var _,ye,Ft,jt,cn,pn,un,us,zt=R(()=>{"use strict";_=ne(De());ze();pe();V();ye=(0,_.createContext)({}),Ft="rm_pageSettings",jt={};try{let e=localStorage.getItem(Ft);jt=JSON.parse(e||"{}")}catch{}cn=({router:e,magModel:t})=>({inPreview:!!e.previewMode,isMagMenuOpen:!1,isTrashOpened:!1,isPageSettingsOpened:!1,isPrivatePagesOpened:!1,isHelpPopupOpened:!1,isUserTemplatesModalShown:!1,isRmTemplatesModalShown:!1,isPageActionsPopupOpenedFor:!1,gridSize:jt.gridSize||0,selectedPages:{},isDragging:!1,magMenuOrientation:t.attributes.opts.viewertype,magMenuOn:t.attributes.opts.menubutton,controlsOnTop:t.attributes.opts.controlsontop,readyToPublish:!0,addingPage:!1,isTeamworkModalOpened:!1,exportAsTemlate:!1,dontRenewScreenshots:!1,showTourOnOpen:!!e.showTourOnOpen,helpTourIsFinished:!!e.helpTourIsFinished,isCartSidebarOpened:!1,showTips:!!e.me?.attributes.constructor_show_tips,masterSharePidIsChanging:!1}),pn=(e,t)=>{let s={...e.selectedPages};return s[t]?delete s[t]:s[t]=!0,s},un=(e,t)=>{switch(t.type){case"togglePreview":{let s=!e.inPreview;return{...e,inPreview:s,readyToPublish:s?!1:e.readyToPublish,notice:void 0}}case"openMagMenu":return{...e,isMagMenuOpen:!0};case"closeMagMenu":return{...e,isMagMenuOpen:!1};case"setMagMenuOrientation":return{...e,magMenuOrientation:t.orientation};case"setMagMenu":return{...e,magMenuOn:t.isOn};case"setControlsOnTop":return{...e,controlsOnTop:t.onTop};case"toggleTrash":return{...e,isTrashOpened:!e.isTrashOpened};case"togglePageSettings":return{...e,isPageSettingsOpened:!e.isPageSettingsOpened,isHelpPanelOpen:!1};case"togglePrivatePages":return{...e,isPrivatePagesOpened:t.payload?!0:!e.isPrivatePagesOpened,privatePageSelected:t.payload};case"toggleHelpPopup":return{...e,isHelpPopupOpened:!e.isHelpPopupOpened};case"toggleHelpTourIsFinished":return{...e,helpTourIsFinished:t.finished};case"toggleUserTemplatesModal":return{...e,isUserTemplatesModalShown:!e.isUserTemplatesModalShown};case"toggleRmTemplatesModal":return{...e,isRmTemplatesModalShown:!e.isRmTemplatesModalShown};case"setPageActionsPopup":return{...e,isPageActionsPopupOpenedFor:t.payload};case"toggleGridSize":return{...e,gridSize:e.gridSize===0?1:0};case"togglePageSelection":return{...e,selectedPages:pn(e,t.payload)};case"setDragging":return{...e,isDragging:t.payload};case"setReadyToPublish":return{...e,readyToPublish:t.ready};case"setAddingPage":return{...e,addingPage:t.inProgress};case"toggleTeamworkModal":return{...e,isTeamworkModalOpened:t.payload};case"toggleExportAsTemlate":return{...e,exportAsTemlate:!e.exportAsTemlate};case"toggleDontRenewScreenshots":return{...e,dontRenewScreenshots:!e.dontRenewScreenshots};case"toggleShowTourOnOpen":return{...e,showTourOnOpen:t.showOnOpen};case"toggleCartSidebarState":return{...e,isCartSidebarOpened:!e.isCartSidebarOpened};case"toggleShowTips":return{...e,showTips:!e.showTips};case"toggleMasterSharePidChanging":return{...e,masterSharePidIsChanging:!e.masterSharePidIsChanging};default:return e}};us=()=>(0,_.useContext)(ye)});var Vt=R(()=>{"use strict";Gt();zt();ze()});function Os(){let e=yn(),t=(0,se.useContext)(ye);(0,se.useEffect)(()=>{typeof window<"u"&&window.RM&&z({...e,router:window.RM.constructorRouter,isSmartTip:$t})},[]);let[{router:s,isSmartTip:l}]=wn(),c=(f,P={})=>{fe()||(P.closeByTimer&&(delete P.closeByTimer,setTimeout(()=>{z(e.visible?{...e,visible:!1}:e)},qt)),z({...e,...P,message:f,needShowHelpIcon:!1,visible:!0,isTipType:!1}))},u=f=>{z({...e,message:f})},d=(f,P={})=>{if(fe()||!s||!s.me||!t.showTips||l&&!Kt(f)||!l&&Kt(f))return;let N=(s.me.get("edu_tips_state")||{})[f]||0,B=()=>{e.visible&&(xe(f,2,s),z({...e,visible:!1}))};if(P.closeByTimer)delete P.closeByTimer,setTimeout(B,qt);else if(l){setTimeout(B,mn);let M=Tn(f);M&&xe(M,3,s)}switch(N){case 3:break;case 2:if(P.showOnce)break;z({...e,visible:!0,message:f,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:P.standAlone});break;case 0:{if(xe(f,2,s),Pn.includes(f)&&v.trigger("tips:show",f),l){let M=bn(f);M&&L.sendAmplitudeEvent(H.EditorTips2,{tip:M})}else{let M=fn(f);M&&L.sendAmplitudeEvent(H.EditorTips,{tip:M})}z({...e,visible:!0,message:f,canBeClosed:!0,needShowHelpIcon:!0,isTipType:!0,standAlone:P.standAlone})}}},T=()=>{e.visible&&e.message&&(xe(e.message,3,s),z({...e,visible:!1}))},y=()=>{e.visible&&z({...e,visible:!1})},O=(f,P)=>{if(!s||!s.me||!s.me.get("constructor_show_tips")||fe()||!t.showTips)return;let k=hn(f,P,s),N=s.me.get("edu_tips_state")||{},B=(M,E)=>{if(!M||!E)return!1;for(let $ in E)if(E.hasOwnProperty($)){let K=M?.[$],X=E[$];if(typeof X=="number"&&typeof K=="number"&&X>K||X!==K)return!1}return!0};for(let M in Ve)if(Ve.hasOwnProperty(M)&&!N[M]){let E=Ve[M];(typeof E=="function"?E(k):B(k,E))&&d(M,{showOnce:!0})}},I=({id:f,color:P})=>{if(!l||!s||!s.me||!$t)return;let k=s.me.get("behavior_metrics")||{},N=k.triggeredColors||{};if(f in N)N[f]=P;else{for(let B of Object.values(N))B===P&&d("eduTipUseColorPalette");N[f]=P,k.triggeredColors=N,s.me.save({behavior_metrics:k},{patch:!0})}};return(0,se.useEffect)(()=>{if(s)return s.on("notice:show",c),s.on("notice:hide",y),s.on("notice:triggerEduTip",d),s.on("notice:triggerEduTipClose",T),s.on("notice:triggerMetrics",O),s.on("notice:triggerColorMetrics",I),()=>{s.off("notice:show",c),s.off("notice:hide",y),s.off("notice:triggerEduTip",d),s.off("notice:triggerEduTipClose",T),s.off("notice:triggerMetrics",O),s.off("notice:triggerColorMetrics",I)}},[s]),{showNotice:c,setNoticeMessage:u,triggerEduTip:d,triggerEduTipClose:T,hideNotice:y,triggerMetrics:O,triggerColorMetrics:I}}var se,$t,Ve,qt,mn,Pn,Jt,Tn,xe,hn,fn,bn,Kt,Sn,wn,z,yn,Fe=R(()=>{"use strict";se=ne(De());He();et();pe();ot();yt();Vt();Jo();$t=Xe("constructor.smartTips"),Ve={eduTipUseViewportsIcon:{viewportIconHovered:!0},eduTipOnDeleteMobileWidget:{widgetDeletedOnMobile:!0},eduTipUseBundleDragTriangle:{bundleDragHovered:!0},eduTipUseShortcutToChangeSizes:{widgetSlightlyResized:!0},eduTipUseShortcutToMoveText:{countTextWidgetCreated:9},eduTipUseShortcutToCopyAnimation:{countAnimatedWidgetCreated:2},eduTipUseShortcutToEnableGuides:{countWidgetCreated:3,guidesTurnOn:void 0},eduTipUseShortcutToEnableSizes:{widgetResized:!0,sizesToolTurnOn:void 0},eduTipUseFix:{countWidgetCreated:10,fixedWidgetUsed:void 0},eduTipUseAbovePages:{countFixedWidgetCreated:3,onAllPagesWidgetUsed:void 0},eduTipUsePlusIcon:{helpTourSkipped:!0},eduTipUseWidgetSettings:{helpTourSkipped:!0,countWidgetCreated:1},eduTipUseBlocks:{secondWidgetMoved:!0},eduTipUseTextStylesWidget:{templateUsed:void 0,countTextWidgetCreated:3},eduTipUseTextStylesControl:{templateUsed:void 0,textWidgetCopied:!0},eduTipUseColorPalette:{sameColorUsed:!0,templateUsed:void 0},eduTipUseArrangeControl:{mobileGroupSelected:!0},eduTipUseGroupEditing:{multipleWidgetsOfSameTypeSelected:!0}},qt=6e3,mn=15e3,Pn=["eduTipUseWidgetSettings","eduTipUseTextStylesControl","eduTipUseColorPalette","eduTipUseArrangeControl"],Jt=[["eduTipUseTextStylesWidget","eduTipUseTextStylesControl"]],Tn=e=>{for(let t=0;t<Jt.length;t++){let s=Jt[t];if(s.includes(e))return s.find(l=>l!==e)}return!1},xe=(e,t,s)=>{let l=s?.me;if(!l)return;let c=l.get("edu_tips_state")||{};c[e]=t,l.save({edu_tips_state:c},{patch:!0})},hn=(e,t,s)=>{let l=s?.me;if(!l)return{};let c=l.get("behavior_metrics")||{},u=e.includes("count"),d=c[e];return u&&t===void 0?c[e]=typeof d=="number"?d+1:1:c[e]=t===void 0?!0:t,l.save({behavior_metrics:c},{patch:!0}),c},fn=e=>{switch(e){case"eduTipUseCommentsMode":return"comments for collaborators";case"eduTipUseShortcutToEnableGuides":return"guides shortcut";default:return!1}},bn=e=>{switch(e){case"eduTipUsePlusIcon":return"plus icon";case"eduTipUseWidgetSettings":return"widget settings";case"eduTipUseBlocks":return"distance between blocks";case"eduTipUseNavigation":return"horizontal vertical navigation";case"eduTipUseColorPalette":return"palette";case"eduTipUseTextStylesWidget":return"text styles";case"eduTipUseTextStylesControl":return"text styles";case"eduTipUseOnboarding":return"beginners onboarding kit";case"eduTipUseArrangeControl":return"arrange";default:return!1}},Kt=e=>!!Object.values(tt).includes(e),Sn={message:"",visible:!1,canBeClosed:!0,needShowHelpIcon:!1,isTipType:!1,router:null},[wn,z,yn]=me(Sn)});export{Tt as a,ln as b,dn as c,xt as d,U as e,vt as f,dr as g,Mt as h,pr as i,ur as j,mr as k,kt as l,hr as m,Nt as n,Sr as o,wr as p,yr as q,xr as r,Ut as s,Lt as t,Yr as u,Qr as v,ye as w,ps as x,us as y,Vt as z,Pn as A,wn as B,yn as C,Os as D,Fe as E,j as F,Yn as G,wt as H,Qn as I,Zn as J,sn as K,er as L,tr as M,or as N,nr as O,fe as P,yt as Q};
