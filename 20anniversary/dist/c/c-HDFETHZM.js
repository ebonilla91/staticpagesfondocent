import{a as F,b as tt}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-AI4SJFEI.js";import{a as U,b as J}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-T2QADY3C.js";import{a as L,b as it,c as G,d as et}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-UH5CHX6B.js";import{a as S,b as X}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-7NT5O6UL.js";import{a as w,b as Q}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-TRPHXH4T.js";import{a as P,b as j}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-DQLWRJ6O.js";import{n as m,o as R}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-PJF6UIFY.js";import{a as q}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-CHUQBVQY.js";import{q as Z}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-QQSGI2X4.js";import{a as B}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-BHCSVH3M.js";import{a as I,b as K}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-F5RDH3FM.js";import{a as O}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-L5GBYYT7.js";import{a as x,d as $}from"https://d1id5eheivyv24.cloudfront.net/98c7974b/dist/c/c-IDSWT3EJ.js";var v,D=x(()=>{"use strict";j();v={"template-common-hotspot-widget":P`

    <div class="common-hotspot">
      <div class="pin"></div>
    </div>

`,"template-common-hotspot-widget-mobile-wrapper":P`

    <div class="hotspot-fullscreen-wrapper invisible">
        <div class="center-table">
            <div class="center-cell">

            </div>
        </div>
    </div>
    
`,"template-common-hotspot-widget-mobile-wrapper-for-constructor":P`
  
  <div class="hotspot-fullscreen-wrapper invisible"></div>

  `}});var y,nt,H,at,M=x(()=>{"use strict";y={w:30,h:30,x:"center",pin_type:"ellipse",bg_color:"ff8888",bg_opacity:1,borders:0,color:"000000",opacity:1,tip_x:null,tip_y:null,tip_w:240,tip_h:120,tip_show_on:"click","tip_background-color":"ffffff","tip_background-color-opacity":100,"tip_border-radius":8,"tip_box-shadow":!0,"tip_box-fullscreen":!1,tipBorder:0,tipBorderColor:"000000",tipBorderOpacity:100,wids:[],flags:{tipFreePosition:!0}},nt=280,H=15,at={WIDTH_OF_BLOCK_WITHOUT_WIDGET:y.tip_w,HEIGHT_OF_BLOCK_WITHOUT_WIDGET:y.tip_h,MIN_WORKSPACE_SIZE_TO_DISPLAY_CONTROL_VERTICALLY:365}});var V,A,N,st,z,Y=x(()=>{"use strict";V=$(B()),A=$(q()),N=$(O());D();R();M();st=A.default.View.extend({initialize:function(t){t&&(N.default.bindAll(this),this.block=t.block,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,this.template=v["template-common-hotspot-widget"],this.render())},render:function(){this.setElement((0,V.default)(this.template({data:this.model}))),this.environment==="viewer"&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&this.$(".tip").css(t)},apply_tip_bg_color:function(t){this.$(".blocks-wrapper").css("background-color",m.getRGBA(t["tip_background-color"],t["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},applyTipBorder:function(t){this.$(".border-wrapper").css("border",`${t.tipBorder||y.tipBorder}px solid ${m.getRGBA(t.tipBorderColor||y.tipBorderColor,(t.tipBorderOpacity||y.tipBorderOpacity)/100)}`)},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t){if(t.flags?.tipFreePosition||!1){let e=this.$(".tip"),i={};return t.fixed_position==="sw"||t.fixed_position==="s"?(i.bottom=t.tip_y-t.y,i.left=t.tip_x-t.x,i.top="",i.right=""):t.fixed_position==="se"?(i.bottom=t.tip_y-t.y,i.right=t.tip_x-t.x,i.top="",i.left=""):t.fixed_position==="e"||t.fixed_position==="ne"?(i.top=t.tip_y-t.y,i.right=t.tip_x-t.x,i.left="",i.bottom=""):(i.top=t.tip_y-t.y,i.left=t.tip_x-t.x,i.right="",i.bottom=""),e.css(i),i}else{let e=this.$(".tip"),i=t.tip_pos,o=t.tip_w,r=t.tip_h||120,p=t.w,u=t.h,l="",n="",b=H,T;return i==="top"?(l=-(b+r),n=p/2-o/2):i==="right"?(l=u/2-r/2,n=p+b):i==="bottom"?(l=u+b,n=p/2-o/2):i==="left"&&(l=u/2-r/2,n=-(b+o)),T={top:l,left:n},e.css(T),T}},destroy:function(){this.remove()}}),z=st});var h,c,ot,Ct,rt=x(()=>{h=$(B()),c=$(O());Q();R();D();tt();Y();K();X();it();et();J();Z();ot=w.extend(F.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH_FOR_FULLSCREEN:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,TIP_GAP_FOR_WIDGET_WITHOUT_FREE_POSITION:15,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){let t;if(this.makeBox("widget-hotspot"),this.$pinIcons={default:null,onClick:null},this.rendered=!0,this.phoneTipWrapperTemplate=v["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!!(RM.constructorRouter&&RM.constructorRouter.preview),this.useFreePosition=this.flags?.tipFreePosition||!1,t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new z(t),this.$pin=this.$(".pin").addClass("viewer"),this.cursorStyle&&this.$pin.css("cursor",this.cursorStyle),this.started&&this.renderTip(),this.pin_type==="icon"){if(this.$el.addClass("icon"),!this.rasterUrl&&!this.b64url)return this.widgetIsLoaded(),this;let e=(0,h.default)("<img>");e.on("load",c.default.bind(function(){this.$pin.append(e),this.$pinIcons.default=e,this.widgetIsLoaded()},this)).on("error",this.widgetIsLoaded),e.attr("src",this.raster3xUrl||this.raster2xUrl||this.rasterUrl||this.b64url||"")}else this.renderPinShape(),this.widgetIsLoaded();if(this.checkShouldRenderOnClickPinIcon())if((this.clickPinType||this.pin_type)==="icon"){let i={};this.clickRaster3xUrl||this.clickRaster2xUrl||this.clickRasterUrl||this.clickB64url?i={raster3xUrl:this.clickRaster3xUrl,raster2xUrl:this.clickRaster2xUrl,rasterUrl:this.clickRasterUrl,b64url:this.clickB64url}:i={raster3xUrl:this.raster3xUrl,raster2xUrl:this.raster2xUrl,rasterUrl:this.rasterUrl,b64url:this.b64url};let o=(0,h.default)("<img>");o.css("display","none"),o.on("load",c.default.bind(function(){this.$pin.append(o),this.$pinIcons.onClick=o},this)),o.attr("src",i.raster3xUrl||i.raster2xUrl||i.rasterUrl||i.b64url||"")}else this.renderPinShapeForOnClick();else return;return this},checkShouldRenderOnClickPinIcon:function(){let t={pinType:this.clickPinType||this.pin_type,raster3xUrl:this.clickRaster3xUrl||this.raster3xUrl,raster2xUrl:this.clickRaster2xUrl||this.raster2xUrl,rasterUrl:this.clickRasterUrl||this.rasterUrl,b64url:this.clickB64url||this.b64url,bg_color:this.clickBgColor||this.bg_color,bg_opacity:this.clickBgOpacity||this.bg_opacity,borders:this.clickBorders||this.borders,color:this.clickColor||this.color,opacity:this.clickOpacity||this.opacity};return t.pinType===this.pin_type&&t.raster3xUrl===this.raster3xUrl&&t.raster2xUrl===this.raster2xUrl&&t.rasterUrl===this.rasterUrl&&t.b64url===this.b64url&&t.clickBgColor===this.bg_color&&t.clickBgOpacity===this.bg_opacity&&t.clickBorders===this.borders&&t.clickColor===this.color&&t.clickOpacity===this.opacity?!1:!this.isHoverable()},togglePinIcon:function(){let t=!this.isHoverable()&&this.isTipVisible===!0;this.checkShouldRenderOnClickPinIcon()&&(t?this.$pinIcons.onClick&&(this.$pinIcons.onClick.css("display","block"),this.$pinIcons.default&&this.$pinIcons.default.css("display","none")):this.$pinIcons.default&&(this.$pinIcons.default.css("display","block"),this.$pinIcons.onClick&&this.$pinIcons.onClick.css("display","none")))},renderPinShape:function(){let t=new Backbone.Model(this);t.id=this._id;let s=(0,h.default)(this.generateShapeSVG("viewer",t,this.w,this.h));this.$pinIcons.default=s,this.$pin.append(s)},renderPinShapeForOnClick:function(){let t=new Backbone.Model(this);t.id=this._id;let s={bg_color:this.clickBgColor||this.bg_color,bg_opacity:this.clickBgOpacity||this.bg_opacity,borders:this.clickBorders||this.borders,color:this.clickColor||this.color,opacity:this.clickOpacity||this.opacity,pin_type:this.clickPinType||this.pin_type,addToCaller:"click"},e=(0,h.default)(this.generateShapeSVG("viewer",t,this.w,this.h,s.pin_type,s));e.css("display","none"),this.$pinIcons.onClick=e,this.$pin.append(e)},renderTip:function(){let t=this.page?.mag?.viewport||"default";if(!this.isTipRendered){if(this.$tip=(0,h.default)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=(0,h.default)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":m.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.tipBorder&&this.tipBorderColor&&this.tipBorderOpacity&&(this.$borderWrapper=(0,h.default)('<div class="border-wrapper"></div>'),this.$borderWrapper.appendTo(this.$tip),this.$borderWrapper.css({border:`${this.tipBorder}px solid ${m.getRGBA(this.tipBorderColor,this.tipBorderOpacity/100)}`})),this.$(".common-hotspot").append(this.$tip),this.pictureData=c.default.findWhere(this.wids||[],{type:"picture"}),this.textData=c.default.findWhere(this.wids||[],{type:"text"}),t!=="default"&&(this.pictureData&&(this.pictureData={...this.pictureData,...this.pictureData[`viewport_${t}`]}),this.textData&&this.textData[`viewport_${t}`])){let s=this.textData[`viewport_${t}`],e={},i=["blocks"];for(let o in s)s.hasOwnProperty(o)&&(i.includes(o)||(e[o]=s[o]));this.textData={...this.textData,...e}}if(this.blocks=[],this.hasPictureWidget=!!(this.pictureData&&!this.pictureData.hidden),this.hasTextWidget=!!(this.textData&&!this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureData.useFreePosition=this.useFreePosition,this.pictureWidget=new S(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.blocks.push(this.pictureWidget),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.useFreePosition=this.useFreePosition,this.textData.hasGlobalParent=this.is_global,this.textData.version===3?this.textWidget=new G({...this.textData,is_above:this.is_above,is_global:this.is_global},this.page,this.$blocksWrapper):this.textWidget=new L(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.blocks.push(this.textWidget),this.textWidget.render()),!this.hasPictureWidget&&!this.hasTextWidget){this.blocks=[],this.$tip.remove();return}this.$closeButton=(0,h.default)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0}},updatePage:function(t){w.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return w.prototype.start.call(this),this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return w.prototype.stop.call(this),this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){if(this.useFreePosition)this.hotspotWidget.apply_tip_position({y:this.y,x:this.x,tip_y:this.tip_y,tip_x:this.tip_x,flags:this.flags,fixed_position:this.fixed_position});else{let C=function(d){let a,_,f,g;switch(d){case"top":a=e.top-o.h/2-p-r.h,f=e.bottom+o.h/2+p,g=e.left-r.w/2,_=e.right-r.w/2;break;case"right":a=e.top-r.h/2,f=e.bottom-r.h/2,g=e.left+o.w/2+p,_=e.right-o.w/2-p-r.w;break;case"bottom":a=e.bottom+o.h/2+p,f=e.bottom-o.h/2-p-r.h,g=e.left-r.w/2,_=e.right-r.w/2;break;case"left":a=e.top-r.h/2,f=e.bottom-r.h/2,g=e.left-o.w/2-p-r.w,_=e.right+o.w/2+p;break}return{top:a,left:g,bottom:f,right:_}},E=function(d){let a=d,_=-1/0,f,g=!1;return c.default.each(["top","right","bottom","left"],function(k){if(g)return;let W=C(k);f=c.default.min(W),k===d&&W[k]>0?(a=k,g=!0):f>_&&W[k]>=0&&(_=f,a=k)}),a};var t=C,s=E;let e=this.calcDistsToPageVisibleBounds(),i,o={w:this.w,h:this.h},r={w:this.$tip.width(),h:this.$tip.height()},p=this.TIP_GAP_FOR_WIDGET_WITHOUT_FREE_POSITION,u=this.tip_pos,l=c.default.pick(this,"w","h","tip_w","tip_h","tip_pos"),n,b=!1,T=!1;u=E(this.tip_pos),l.tip_pos=u,n=this.hotspotWidget.apply_tip_position(l),i=C(u),c.default.each(i,function(d,a){if(d<0)switch(a){case"top":n.top-=d-this.EDGE_GAP,b=!0;break;case"bottom":b||(n.top+=d-this.EDGE_GAP);break;case"left":n.left-=d-this.EDGE_GAP,T=!0;break;case"right":T||(n.left+=d-this.EDGE_GAP);break}}.bind(this)),this.$tip.css(n)}},adjustPictureSize:function(){let t=this.tip_w/this.PHONE_TIP_WIDTH_FOR_FULLSCREEN,s;this.pictureWidget&&(this.isPhone()?s={width:this.PHONE_TIP_WIDTH_FOR_FULLSCREEN,height:this.pictureData.h/t}:s={width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(s))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("rm_hotspot_click",this._id))},onMouseenter:function(){!this.isHoverable()||!this.isTipRendered||(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("rm_hotspot_hover",this._id))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){if(!this.isTipRendered)return;let t=this["tip_box-fullscreen"]!==void 0?this["tip_box-fullscreen"]:this.isPhone();if(this.isPhone()&&(t||!this.useFreePosition)){this.adjustPictureSize(),this.$phoneTipWrapper=this.$phoneTipWrapper||(0,h.default)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tipContainer=this.$phoneTipWrapper.find(".center-cell"),this.$tip.detach().appendTo(this.$tipContainer);let s=this.mag.getScale(this.page.pageViewport);this.$tip.css({transform:`scale(${s})`});let e=U.mapElementToViewport(this.$tip[0],s,1);this.$tipContainer.css({height:e.height}),c.default.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(i){let o=(0,h.default)(i.target).closest("a");if(!o)return;let r=o.hasClass("external-link"),p=o.hasClass("close-tip-on-click"),u=o.hasClass("current"),l=this.$tipContainer.is((0,h.default)(i.target));if(r||i.preventDefault(),p||u||l){this.hideTip(),this.$phoneTipWrapper.off();return}}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)}else this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.$container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||(0,h.default)("body").on("keydown",this.onBodyKeyDown);this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.blocks?.forEach(s=>{s?.$el.on("click",this.onTipLinkClick)}),this.isTipVisible=!0,this.togglePinIcon()},hideTip:function(){if(!this.isTipVisible)return;let t=this["tip_box-fullscreen"]!==void 0?this["tip_box-fullscreen"]:this.isPhone();this.isTipVisible=!1,this.togglePinIcon(),clearTimeout(this.mouseLeaveTimeout),this.isPhone()&&(t||t===void 0||!this.useFreePosition)?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),c.default.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.BackToNormalZ(),(0,h.default)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"),this.blocks?.forEach(s=>{s?.$el.off("click",this.onTipLinkClick)})},onTipLinkClick:function(t){let s=(0,h.default)(t.currentTarget),e=s.parent().hasClass("close-tip-on-click"),i=s.hasClass("close-tip-on-click"),o=!!s.find(".close-tip-on-click")?.length;(e||i||o)&&this.hideTip()},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();let s=(0,h.default)(t.currentTarget),e=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(e<0&&s.scrollTop()<=0||e>0&&s.scrollTop()+s.height()>=s[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){let s=(0,h.default)(t.target),e=s.closest(".pin"),i=s.closest(".tip");e.is(this.$pin)||i.is(this.$tip)||(this.page.mag.$container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return I.isPhone||this.isPreview&&this.page.mag.viewport==="phone_portrait"},isHoverable:function(){return this.tip_show_on==="hover"&&I.isDesktop&&!this.isPhone()&&this.page.mag.viewport!=="tablet_portrait"},onBodyKeyDown:function(t){t.keyCode===h.default.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,w.prototype.destroy.apply(this,arguments)}}),Ct=ot});export{v as a,D as b,y as c,nt as d,at as e,M as f,z as g,Y as h,Ct as i,rt as j};
